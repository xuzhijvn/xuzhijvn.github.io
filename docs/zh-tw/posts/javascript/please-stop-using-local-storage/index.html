<!doctype html>
<html lang="zh-tw">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Please Stop Using Local Storage For Storing Sensitive Data - Razon Yang</title><link rel="apple-touch-icon" href="https://xuzhijvn.github.io/images/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://xuzhijvn.github.io/images/favicons/manifest.json">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon.ico">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="Please Stop Using Local Storage For Storing Sensitive Data">
<meta itemprop="description" content="此前筆者搜索過不少前後端分離，身份驗證 token 應該存放在哪的問題，不少結果都說放到 Local Storage，但放到 Local Storage 真的安全嗎？這正是分享本篇文章的原因，希望能幫助到其他有相同疑惑的開發者。"><meta itemprop="datePublished" content="2020-01-04T17:05:47+00:00" />
<meta itemprop="dateModified" content="2020-01-04T17:05:47+00:00" />
<meta itemprop="wordCount" content="2536">
<meta itemprop="keywords" content="JavaScript,Local Storage," /><meta property="og:title" content="Please Stop Using Local Storage For Storing Sensitive Data" />
<meta property="og:description" content="此前筆者搜索過不少前後端分離，身份驗證 token 應該存放在哪的問題，不少結果都說放到 Local Storage，但放到 Local Storage 真的安全嗎？這正是分享本篇文章的原因，希望能幫助到其他有相同疑惑的開發者。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xuzhijvn.github.io/zh-tw/posts/javascript/please-stop-using-local-storage/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-04T17:05:47+00:00" />
<meta property="article:modified_time" content="2020-01-04T17:05:47+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Please Stop Using Local Storage For Storing Sensitive Data"/>
<meta name="twitter:description" content="此前筆者搜索過不少前後端分離，身份驗證 token 應該存放在哪的問題，不少結果都說放到 Local Storage，但放到 Local Storage 真的安全嗎？這正是分享本篇文章的原因，希望能幫助到其他有相同疑惑的開發者。"/>
<meta name="twitter:site" content="@razonyang"/>
<meta data-name="palette" content="indigo"><link rel=stylesheet href="https://xuzhijvn.github.io/css/bundle.min.120cd278725330bacf892c23f75f625397123aac51c2ea0e5c4a34c61e96738d.css" integrity="sha256-EgzSeHJTMLrPiSwj919iU5cSOqxRwuoOXEo0xh6Wc40=" crossorigin="anonymous"><script src="https://xuzhijvn.github.io/js/bundle.min.e32615bc744413570374d5b28e8c02ec03c7b28c31485b6fcc5b6174a08766d9.js" integrity="sha256-4yYVvHREE1cDdNWyjowC7APHsowxSFtvzFthdKCHZtk=" crossorigin="anonymous"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-97403777-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?1748e454242a1146387e079e3bb3a92a";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script><script data-ad-client="ca-pub-7827859788508375" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><header><nav class="navbar navbar-expand-xl fixed-top">
  <div class="container">
    <a class="navbar-brand" href="https://xuzhijvn.github.io/zh-tw/">
      <img class="logo" alt="Logo" src="https://xuzhijvn.github.io/images/logo.webp" loading="lazy">RAZON YANG</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action="https://xuzhijvn.github.io/zh-tw/search">
  <div class="input-group input-group-sm">
    <button class="btn btn-search disabled position-absolute left-0" type="submit"><i class="fas fa-fw fa-search"></i></button>
    <input class="form-control rounded-pill" id="searchQuery" name="q" type="search" aria-label="Search">
  </div>
</form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class="nav-item">
          <a class="nav-link" href="https://xuzhijvn.github.io/zh-tw/archives/">
            <i class="fas fa-fw fa-file-archive"></i>歸檔
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-categories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-folder"></i>分類
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-categories"><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/categories/programing">
                <i class="fas fa-fw fa-code"></i>Programing
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/categories/linux">
                <i class="fab fa-fw fa-linux"></i>Linux
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/categories/server">
                <i class="fas fa-fw fa-server"></i>Server
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/categories">
                <i class="fas fa-fw fa-folder"></i>所有分類
              </a>
            </li></ul>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-tags" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-tags"></i>標籤
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-tags"><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/php">
                <i class="fab fa-fw fa-php"></i>PHP
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/go">
                <i class="fab fa-fw fa-google"></i>Go
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/mysql">
                <i class="fas fa-fw fa-database"></i>MySQL
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/html">
                <i class="fab fa-fw fa-html5"></i>HTML
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/mysql">
                <i class="fab fa-fw fa-js"></i>JavaScript
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags/css">
                <i class="fab fa-fw fa-css3"></i>CSS
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/zh-tw/tags">
                <i class="fas fa-fw fa-tags"></i>所有標籤
              </a>
            </li></ul>
        </li><li class="nav-item">
          <a class="nav-link" href="https://xuzhijvn.github.io/zh-tw/series">
            <i class="fas fa-fw fa-columns"></i>專欄
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            項目
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-projects"><li>
              <a class="dropdown-item"
                href="https://clevergo.tech/" target="_blank">
                CleverGo
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://gopkgs.net/" target="_blank">
                GOPKGS
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank">
                Hugo Bootstrap 主題
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://admin.yii2.razonyang.com/" target="_blank">
                Yii 2 管理後台
              </a>
            </li></ul>
        </li><li class="nav-item dropdown">
  <a class="nav-link" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="fas fa-fw fa-language"></i> 繁體中文
  </a>
  <ul class="dropdown-menu" aria-labelledby="languageDropdown"><li><a class="dropdown-item" href="https://xuzhijvn.github.io/zh-cn/">简体中文</a></li><li><a class="dropdown-item" href="https://xuzhijvn.github.io/en/">English</a></li></ul>
</li><li class="nav-item">
  <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasSettings" role="button"
    aria-controls="offcanvasSettings">
    <i class="fas fa-fw fa-sliders-h"></i> 設置
  </a>
</li>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings"
  aria-labelledby="offcanvasSettingsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" w id="offcanvasSettingsLabel"><i class="fas fa-fw fa-sliders-h"></i> 設置</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body"><section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> 模式</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>
<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> 配色</label>
    </div>
    <div class="col-auto ms-auto">
      <span id="btnPalette" class="btn btn-sm"><i class="fas fa-eye-dropper"></i></span>
    </div>
  </form>
  <div class="container mt-2 visually-hidden" id="palettePicker">
    <div class="btn-group"><button type="button" id="palette-blue" title="藍色" 
          class="btn btn-sm palette bg-blue d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-blue-gray" title="藍灰色" 
          class="btn btn-sm palette bg-blue-gray d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-brown" title="棕色" 
          class="btn btn-sm palette bg-brown d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-cyan" title="青色" 
          class="btn btn-sm palette bg-cyan d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-green" title="綠色" 
          class="btn btn-sm palette bg-green d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-indigo" title="靛青色" 
          class="btn btn-sm palette bg-indigo d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-orange" title="橙色" 
          class="btn btn-sm palette bg-orange d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-pink" title="粉色" 
          class="btn btn-sm palette bg-pink d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-purple" title="紫色" 
          class="btn btn-sm palette bg-purple d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-red" title="紅色" 
          class="btn btn-sm palette bg-red d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-teal" title="藍綠色" 
          class="btn btn-sm palette bg-teal d-flex align-items-center justify-content-center">
        </button><button type="button" id="palette-yellow" title="黃色" 
          class="btn btn-sm palette bg-yellow d-flex align-items-center justify-content-center">
        </button></button>
    </div>
  </div>
</section></div>
</div></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row" aria-label="breadcrumb">
  <ol class="breadcrumb surface"><li class="breadcrumb-item"><a href="https://xuzhijvn.github.io/zh-tw/">主頁</a></li><li class="breadcrumb-item"><a href="https://xuzhijvn.github.io/zh-tw/posts/">文章</a></li><li class="breadcrumb-item"><a href="https://xuzhijvn.github.io/zh-tw/posts/javascript/">JavaScript</a></li><li class="breadcrumb-item active">Please Stop Using Local Storage For Storing Sensitive Data</li></ol>
</nav><article class="post row surface"><div class="post-panel-wrapper">
  <div class="post-panel d-flex flex-column">
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button">
  <i class="fas fa-fw fa-expand-alt fa-rotate-45"></i>
</a>
  
    

    
    
    <a id="btnTOC" class="fas fa-fw fa-list-alt" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button">
</a>
  </div>
</div>
<h1 class="post-title my-3">Please Stop Using Local Storage For Storing Sensitive Data
</h1><div class="post-meta mb-3">
  <span class="post-date me-2">
    <i class="fas fa-fw fa-calendar-alt"></i>2020-01-04
  </span>
  <span class="post-reading-time me-2">
    <i class="fas fa-fw fa-coffee"></i>12 分鐘閱讀
  </span><a href="https://xuzhijvn.github.io/zh-tw/categories/programing/" class="post-taxonomy">#Programing</a><a href="https://xuzhijvn.github.io/zh-tw/tags/javascript/" class="post-taxonomy">#JavaScript</a><a href="https://xuzhijvn.github.io/zh-tw/tags/local-storage/" class="post-taxonomy">#Local Storage</a></div>
<div class="post-share mb-3"><div class="addthis_inline_share_toolbox"></div></div><div class="offcanvas offcanvas-end surface" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasTOCLabel">目錄</h5>
    <a role="button" data-bs-dismiss="offcanvas" aria-label="Close">
      <span class="fas fa-2x fa-fw fa-times"></span>
    </a>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-local-storage">What is Local Storage?</a></li>
    <li><a href="#whats-cool-about-local-storage">What’s Cool About Local Storage?</a></li>
    <li><a href="#what-sucks-about-local-storage">What Sucks About Local Storage</a></li>
    <li><a href="#why-local-storage-is-insecure-and-you-shouldnt-use-it-to-store-sensitive-data">Why Local Storage is Insecure and You Shouldn’t Use it to Store Sensitive Data</a></li>
    <li><a href="#psa-dont-store-json-web-tokens-in-local-storage">PSA: Don’t Store JSON Web Tokens in Local Storage</a></li>
    <li><a href="#what-to-use-instead-of-local-storage">What to Use Instead of Local Storage</a>
      <ul>
        <li><a href="#sensitive-data">Sensitive Data</a></li>
        <li><a href="#non-string-data">Non-String Data</a></li>
        <li><a href="#offline-data">Offline Data</a></li>
      </ul>
    </li>
    <li><a href="#please-stop-using-local-storage">Please Stop Using Local Storage</a></li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><p>此前筆者搜索過不少前後端分離，身份驗證 token 應該存放在哪的問題，不少結果都說放到 Local Storage，但放到 Local Storage 真的安全嗎？這正是分享本篇文章的原因，希望能幫助到其他有相同疑惑的開發者。</p>
<p>Seriously. Just stop it already.</p>
<p>I don’t know what it is, exactly, that drives so many developers to store session information in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage" target="_blank">local storage</a>
, but whatever the reason: the practice needs to die out. Things are getting completely out of hand.</p>
<p>Almost every day I stumble across a new website storing sensitive user information in local storage and it bothers me to know that so many developers are opening themselves up to catastrophic security issues by doing so.</p>
<p>Let’s have a heart-to-heart and talk about local storage and why you should stop using it to store session data.</p>
<blockquote>
<p>Source: <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" target="_blank">Please Stop Using Local Storage</a>
</p>
</blockquote>
<h2 id="what-is-local-storage">What is Local Storage?</h2>
<p>I’m sorry if I was a bit grumpy earlier. You don’t deserve that! Heck, you might not even be familiar with what local storage is, let alone be using it to store your session information!</p>
<p>Let’s start with the basics: local storage is a new feature of HTML5 that basically allows you (a web developer) to store any information you want in your user’s browser using JavaScript. Simple, right?</p>
<p>In practice, local storage is just one big old JavaScript object that you can attach data to (or remove data from). Here’s an example of some JavaScript code that stores some of my personal info in local storage, echoes it back to me, and then (optionally) removes it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">    <span style="color:#75715e">// You can store data in local storage using either syntax
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">userName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rdegges&#34;</span>;
    <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#34;favoriteColor&#34;</span>, <span style="color:#e6db74">&#34;black&#34;</span>);

    <span style="color:#75715e">// Once data is in localStorage, it&#39;ll stay there forever until it is
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// explicitly removed
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">userName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; really likes the color &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">favoriteColor</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span>);

    <span style="color:#75715e">// Removing data from local storage is also pretty easy. Uncomment the lines
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// below to destroy the entries
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//localStorage.removeItem(&#34;userName&#34;);
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//localStorage.removeItem(&#34;favoriteColor&#34;);
</span></code></pre></div><p>If you run the JavaScript code above in your browser on a test HTML page, you’ll see the phrase “rdegges really likes the color black.” in an alert message. If you then open up your developer tools, you’ll be able to see the that both the <code>userName</code> and <code>favoriteColor</code> variables are both stored in local storage in your browser:</p>
<p>Now you might be wondering if there’s some way to use local storage so that the data you store is automatically deleted at some point and you don’t need to manually delete every single variable you put in there. Luckily, the HTML5 working group (shout out!) has your back. They added something called sessionStorage to HTML5 which works <em>exactly</em> the same as local storage except that all data it stores is automatically deleted when the user closes their browser tab.</p>
<h2 id="whats-cool-about-local-storage">What’s Cool About Local Storage?</h2>
<p>Now that we’re on the same page about what local storage is, let’s talk about what makes it cool! Even though the whole point of this article is to dissuade you from using local storage to store session data, local storage still has some interesting properties.</p>
<p>For one thing: it’s pure JavaScript! One of the annoying things about cookies (the only real alternative to local storage) is that they need to be created by a web server. Boo! Web servers are boring and complex and hard to work with.</p>
<p>If you’re building a static site (like a single page app, for instance), using something like local storage means your web pages can run independently of any web server. They don’t need any backend language or logic to store data in the browser: they can just do it as they please.</p>
<p>This is a pretty powerful concept and one of the main reasons that local storage is such a hit with developers.</p>
<p>Another neat thing about local storage is that it doesn’t have as many size constraints as cookies. Local storage provides at least 5MB of data storage across all major web browsers, which is a heck of a lot more than the 4KB (maximum size) that you can store in a cookie.</p>
<p>This makes local storage particularly useful if you want to cache some application data in the browser for later usage. Since 4KB (the cookie max size) isn’t a lot, local storage is one of your only real alternative options.</p>
<h2 id="what-sucks-about-local-storage">What Sucks About Local Storage</h2>
<p>OK. We talked about the good, now let’s spend a minute (or two!) talking about the bad.</p>
<p>Local storage is soooo <em>basic</em>. WHEW. I feel better already getting that off my chest. Local storage is just an incredibly basic, simple API.</p>
<p>I feel like most developers don’t realize just how basic local storage actually is:</p>
<ul>
<li>
<p>It can only store string data. Boo. This makes it pretty useless for storing data that’s even slightly more complex than a simple string. And sure, you <em>could</em> serialize everything including data types into local storage, but that’s an ugly hack.</p>
</li>
<li>
<p>It is synchronous. This means each local storage operation you run will be one-at-a-time. For complex applications this is a big no-no as it’ll slow down your app’s runtime.</p>
</li>
<li>
<p>It can’t be used by <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank">web workers</a>
 =/ This means that if you want to build an application that takes advantage of background processing for performance, chrome extensions, things like that: you can’t use local storage at all since it isn’t available to the web workers.</p>
</li>
<li>
<p>It still limits the size of data you can store (~5MB across all major browsers). This is a fairly low limit for people building apps that are data intensive or need to function offline.</p>
</li>
<li>
<p>Any JavaScript code on your page can access local storage: it has no data protection whatsoever. <strong>This is the big one for security reasons</strong> (as well as my number one pet peeve in recent years).</p>
</li>
</ul>
<p>To keep it short, here’s the only situation in which you should use local storage: when you need to store some publicly available information that is not at all sensitive, doesn’t need to be used in a high performance app, isn’t larger than 5MB, and consists of purely string data.</p>
<p>If the app you’re using doesn’t fit the above description: <em>don’t use local storage</em>. Use something else (more on this later).</p>
<h2 id="why-local-storage-is-insecure-and-you-shouldnt-use-it-to-store-sensitive-data">Why Local Storage is Insecure and You Shouldn’t Use it to Store Sensitive Data</h2>
<p>Here’s the deal: most of the bad things about local storage aren’t all that important. You can still get away with using it but you’ll just have a slightly slower app and minor developer annoyance. But security is different. The security model of local storage IS really important to know and understand, since it will dramatically affect your website in ways you may not realize.</p>
<p>And the thing about local storage is that it is <em>not secure</em>! Not at all! Everyone who uses local storage to store sensitive information such as session data, user details, credit card info (even temporarily!) and anything else you wouldn’t want publicly posted to Facebook is doing it wrong.</p>
<p>Local storage <em>wasn’t designed</em> to be used as a secure storage mechanism in a browser. It was designed to be a simple string only key/value store that developers could use to build slightly more complex single page apps. That’s it.</p>
<p>What’s the most dangerous thing in the entire world? That’s right! JavaScript.</p>
<p>Think about it like this: when you store sensitive information in local storage, you’re essentially using the most dangerous thing in the world to store your most sensitive information in the worst vault ever created: not the best idea.</p>
<p>What the problem really boils down to is cross-site scripting attacks (<a href="https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29" target="_blank">XSS</a>
). I won’t bore you with a full explanation of XSS, but here’s the high level:</p>
<p>If an attacker can run JavaScript on your website, they can retrieve all the data you’ve stored in local storage and send it off to their own domain. This means anything sensitive you’ve got in local storage (like a user’s session data) can be compromised.</p>
<p>Now, you might be thinking “So what? My website is secure. No attacker can run JavaScript on my website.”</p>
<p>And that’s a reasonable point. If your website is <em>truly</em> secure and no attacker can run JavaScript code on your website then you are technically safe, but in reality that is incredibly hard to achieve. Let me explain.</p>
<p>If your website contains <em>any</em> third party JavaScript code included from a source outside your domain:</p>
<ul>
<li>Links to bootstrap</li>
<li>Links to jQuery</li>
<li>Links to Vue, React, Angular, etc.</li>
<li>Links to any ad network code</li>
<li>Links to Google Analytics</li>
<li>Links to any tracking code</li>
</ul>
<p>Then you are currently at risk for having an attacker run JavaScript on your website. Let’s say your website has the following script tag embedded inside it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://awesomejslibrary.com/minified.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><p>In this case, if awesomejslibrary.com is compromised and their <code>minified.js</code> script gets altered to:</p>
<ul>
<li>Loop through all data in local storage</li>
<li>Send it to an API built to collect stolen information</li>
</ul>
<p>… then you are completely screwed. In this situation the attacker would have easily been able to compromise anything you had stored in local storage and you would never notice. Not ideal.</p>
<p>As engineers, I think we’re frequently susceptible to thinking that we would never embed third party JavaScript in our websites. But in the real world, this scenario rarely plays out.</p>
<p>At most companies the marketing team directly manages the public website using different WYSIWYG editors and tooling. Can you <em>really</em> be sure that nowhere on your site are you using third party JavaScript? I’d argue “no”.</p>
<p>So to err on the side of caution and dramatically reduce your risk for a security incident: <strong>don’t store anything sensitive in local storage</strong>.</p>
<h2 id="psa-dont-store-json-web-tokens-in-local-storage">PSA: Don’t Store JSON Web Tokens in Local Storage</h2>
<p>While I feel like I made myself clear that you should never <em>ever</em> store sensitive information in local storage in the previous section, I feel the need to specifically call out JSON Web Tokens (JWTs).</p>
<p>The biggest security offenders I see today are those of us who store JWTs (session data) in local storage. Many people don’t realize that JWTs are essentially the same thing as a username/password.</p>
<p>If an attacker can <a href="https://stackoverflow.com/questions/34259248/what-if-jwt-is-stolen" target="_blank">get a copy of your JWT</a>
, they can make requests to the website on your behalf and you will never know. Treat your JWTs like you would a credit card number or password: don’t ever store them in local storage.</p>
<p>There are thousands of tutorials, YouTube videos, and even programming classes at universities and coding bootcamps incorrectly teaching new developers to store JWTs in local storage as an authentication mechanism. <strong>THIS INFORMATION IS WRONG.</strong> If you see someone telling you to do this, run away!</p>
<h2 id="what-to-use-instead-of-local-storage">What to Use Instead of Local Storage</h2>
<p>So with all of local storage’s shortcomings, what should you use instead? Let’s explore the alternatives!</p>
<h3 id="sensitive-data">Sensitive Data</h3>
<p>If you need to store sensitive data, you should always use a server-side session. Sensitive data includes:</p>
<ul>
<li>User IDs</li>
<li>Session IDs</li>
<li>JWTs</li>
<li>Personal information</li>
<li>Credit card information</li>
<li>API keys</li>
<li>And anything else you wouldn’t want to publicly share on Facebook</li>
</ul>
<p>If you need to store sensitive data, here’s how to do it:</p>
<ul>
<li>
<p>When a user logs into your website, create a session identifier for them and store it in a cryptographically signed cookie. If you’re using a web framework, look up “how to create a user session using cookies” and follow that guide.</p>
</li>
<li>
<p>Make sure that whatever cookie library your web framework uses is setting the <code>httpOnly</code> cookie flag. This flag makes it impossible for a browser to read any cookies, which is <em>required</em> in order to safely use server-side sessions with cookies. Read <a href="https://blog.codinghorror.com/protecting-your-cookies-httponly/" target="_blank">Jeff Atwood’s article</a>
 for more information. He’s the <em>man</em>.</p>
</li>
<li>
<p>Make sure that your cookie library also sets the <code>SameSite=strict</code> cookie flag (to prevent <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29" target="_blank">CSRF</a>
 attacks), as well as the <code>secure=true</code> flag (to ensure cookies can only be set over an encrypted connection).</p>
</li>
<li>
<p>Each time a user makes a request to your site, use their session ID (extracted from the cookie they send to you) to retrieve their account details from either a database or a cache (depending on how large your website is)</p>
</li>
<li>
<p>Once you have the user’s account info pulled up and verified, feel free to pull any associated sensitive data along with it</p>
</li>
</ul>
<p>This pattern is simple, straightforward, and most importantly: <em>secure</em>. And yes, you can most definitely scale up a large website using this pattern. Don’t tell me that JWTs are “stateless” and “fast” and you have to use local storage to store them: you’re wrong!</p>
<h3 id="non-string-data">Non-String Data</h3>
<p>If you need to store data in the browser that isn’t sensitive and isn’t purely string data, the best option for you is IndexedDB. It’s an API that lets you work with a database-esque object store in the browser.</p>
<p>What’s great about IndexedDB is that you can use it to store typed information: integers, floats, etc. You can also define primary keys, handle indexing, and create transactions to prevent data integrity issues.</p>
<p>A great tutorial for learning about (and using) IndexedDB is this <a href="https://developers.google.com/web/ilt/pwa/working-with-indexeddb" target="_blank">Google tutorial</a>
.</p>
<h3 id="offline-data">Offline Data</h3>
<p>If you need your app to run offline, your best option is to use a combination of IndexedDB (above) along with the Cache API (which is a part of Service Workers).</p>
<p>The Cache API allows you to cache network resources that your app needs to load.</p>
<p>A great tutorial for learning about (and using) the Cache API is this <a href="https://developers.google.com/web/fundamentals/instant-and-offline/web-storage/cache-api" target="_blank">Google tutorial</a>
.</p>
<h2 id="please-stop-using-local-storage">Please Stop Using Local Storage</h2>
<p>Now that we’ve had a chance to talk about local storage, I hope you understand why you (probably) shouldn’t be using it.</p>
<p>Unless you need to store publicly available information that:</p>
<ul>
<li>Is not at all sensitive</li>
<li>Doesn’t need to be used in an ultra high performance app</li>
<li>Isn’t larger than 5MB</li>
<li>Consists of purely string data</li>
</ul>
<p>… <strong>don’t use local storage!</strong> Use the right tool for the job.</p>
<p>And please, please, whatever you do, do not store session information (like JSON Web Tokens) in local storage. This is a very bad idea and will open you up to an extremely wide array of attacks that could absolutely cripple your users.</p>
<p>Have a question? <a href="mailto:r@rdegges.com">Shoot me an email</a>
.</p>
<p>Stay safe out there =)</p>
<p><strong>NOTE</strong>: For those of you who made it this far who are wondering why I didn’t specifically call out <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank">Content Security Policy</a>
 as a way to mitigate the effects of XSS, I specifically chose not to include this because it cannot help in the situation I described above. Even if you use CSP to whitelist all third party JavaScript domains, that does nothing to prevent XSS if the third party provider is compromised.</p>
<p>And while we’re at it: <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank">subresource integrity</a>
 (while cool) is also not a global solution to this issue. For most marketing tools, ad networks, etc. (which are by far the most commonly used types of third party JavaScript), subresource integrity is almost never used as the providers of those scripts <em>want</em> to change them frequently so they can silently update functionality for their users.</p>
<p><strong>UPDATE</strong>: I’m not the only one who thinks you should never store anything sensitive in local storage. So does <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#local-storage" target="_blank">OWASP</a>
:</p>
<blockquote>
<p>… In other words, any authentication your application requires can be bypassed by a user with local privileges to the machine on which the data is stored. Therefore, it’s recommended not to store any sensitive information in local storage.</p>
</blockquote></div><hr /><div class="post-navs d-flex mb-3 justify-content-between">
  <div class="post-nav w-50"><div class="prev-post btn btn-sm">
      <a href="https://xuzhijvn.github.io/zh-tw/posts/go/gofmt-vs-goimports/">Go 語言代碼格式化工具 gofmt vs goimports
</a>
    </div></div>
  <div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm">
      <a href="https://xuzhijvn.github.io/zh-tw/posts/php/security-do-not-expose-your-phpinfo/">PHP 安全 – 不要暴露 phpinfo
</a>
    </div></div>
</div></article><div class="post-comments surface row"><script src="https://utteranc.es/client.js"
  repo="razonyang/blog"
  issue-term="pathname"
  label=""
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container"><section class="ad row surface justify-content-center">
  <ins class="adsbygoogle sidebar-ad"
    data-ad-client="ca-pub-7827859788508375"
    data-ad-slot="5059539159"
    data-ad-format="auto"
    data-full-width-responsive="false"></ins>
</section>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<section class="profile surface row">
  <div class="col-xl-6 d-flex align-items-center justify-content-center">
    <img class="profile-avatar img-fluid" src="https://xuzhijvn.github.io/images/profile.webp" alt="Razon Yang" loading="lazy">
  </div>
  <div class="col-xl-6">
    <h5 class="profile-name my-2">Razon Yang</h5><div class="profile-bio mb-2">Gopher, PHPer, Full Stack Engineer.</div><div class="profile-company mb-2"><i class="fas fa-fw fa-building"></i>Null</div><div class="profile-location mb-2"><i class="fas fa-fw fa-map-marker-alt"></i>China</div><div class="profile-about mb-2"><i class="fas fa-fw fa-info-circle"></i><a href="https://xuzhijvn.github.io/zh-tw/about/">關於</a></div></div>
</section><section class="featured-posts row surface">
    <h4>精選文章</h4>
    <ul><li><a href="https://xuzhijvn.github.io/zh-tw/posts/go/custom-import-path-via-gopkgs/">利用 gopkgs 自定義 Go 庫的導入路徑
</a></li></ul>
  </section><section class="recent-posts row surface">
  <h4>最近文章</h4>
  <ul><li><a href="https://xuzhijvn.github.io/zh-tw/posts/caddy/redirect-from-old-path-to-new-path/">Caddy 2 重定向舊路徑到新路徑
</a></li><li><a href="https://xuzhijvn.github.io/zh-tw/posts/bootstrap/navbar-dropdown-remove-arrow/">Bootstrap 導航欄下拉菜單移除倒三角圖標
</a></li><li><a href="https://xuzhijvn.github.io/zh-tw/posts/go/custom-import-path-via-gopkgs/">利用 gopkgs 自定義 Go 庫的導入路徑
</a></li><li><a href="https://xuzhijvn.github.io/zh-tw/posts/archlinux/zsh/">Arch Linux 安裝 ZSH
</a></li><li><a href="https://xuzhijvn.github.io/zh-tw/posts/selinux/apache-proxy-error-permission-denied/">SELinux Apache proxy error permission denied
</a></li></ul>
</section><section class="taxonomy-categories row surface">
      <h4>
        <a href="https://xuzhijvn.github.io/zh-tw/categories">分類</a>
      </h4>
      <div><a href="https://xuzhijvn.github.io/zh-tw/categories/programing/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Programing">
          Programing <span class="badge rounded-pill">67</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/categories/linux/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Linux">
          Linux <span class="badge rounded-pill">39</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/categories/server/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Server">
          Server <span class="badge rounded-pill">1</span>
        </a></div>
    </section><section class="taxonomy-tags row surface">
      <h4>
        <a href="https://xuzhijvn.github.io/zh-tw/tags">標籤</a>
      </h4>
      <div><a href="https://xuzhijvn.github.io/zh-tw/tags/leetcode/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="LeetCode">
          LeetCode <span class="badge rounded-pill">26</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/mysql/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="MySQL">
          MySQL <span class="badge rounded-pill">23</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/arch-linux/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Arch Linux">
          Arch Linux <span class="badge rounded-pill">20</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/go/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Go">
          Go <span class="badge rounded-pill">19</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/php/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="PHP">
          PHP <span class="badge rounded-pill">12</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/centos/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="CentOS">
          CentOS <span class="badge rounded-pill">6</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/mariadb/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="MariaDB">
          MariaDB <span class="badge rounded-pill">4</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/nginx/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Nginx">
          Nginx <span class="badge rounded-pill">4</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/apache/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Apache">
          Apache <span class="badge rounded-pill">3</span>
        </a><a href="https://xuzhijvn.github.io/zh-tw/tags/kde/" class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="KDE">
          KDE <span class="badge rounded-pill">3</span>
        </a></div>
    </section><section class="ad ad-sticky row surface justify-content-center">
  <ins class="adsbygoogle sidebar-ad"
    data-ad-client="ca-pub-7827859788508375"
    data-ad-slot="5059539159"
    data-ad-format="auto"
    data-full-width-responsive="false"></ins>
</section>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"><li class="nav-item">
    <a class="nav-link social-link" href="mailto:razonyang@gmail.com" title="Email">
      <i class="fas fa-fw fa-2x fa-envelope"></i>
    </a>
  </li><li class="nav-item">
      <a class="nav-link social-link" target="_blank" href="https://github.com/razonyang" title="GitHub">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a>
    </li><li class="nav-item">
      <a class="nav-link social-link" target="_blank" href="https://gitlab.com/razonyang" title="GitLab">
        <i class="fa-fw fa-2x fab fa-gitlab"></i>
      </a>
    </li><li class="nav-item">
      <a class="nav-link social-link" target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=919680596&amp;site=qq&amp;menu=yes" title="QQ">
        <i class="fa-fw fa-2x fab fa-qq"></i>
      </a>
    </li><li class="nav-item">
      <a class="nav-link social-link" target="_blank" href="https://t.me/razonyang" title="Telegram">
        <i class="fa-fw fa-2x fab fa-telegram-plane"></i>
      </a>
    </li><li class="nav-item">
      <a class="nav-link social-link" target="_blank" href="https://twitter.com/razonyang" title="Twitter">
        <i class="fa-fw fa-2x fab fa-twitter"></i>
      </a>
    </li></nav>
<div class="copyright mb-2">
  Copyright © 2016-2021 Razon Yang. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank">Bootstrap</a> theme.
</div><div class="mb-3">
  <img src = 'https://xuzhijvn.github.io/icons/gongan.png' class = ' transparent'>
  <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44040302000341">粤公网安备44040302000341号</a>
  |
  <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备20043980号</a>
</div>
</footer>
<a id="btnScrollToTop" class="btn-scroll-to-top">
  <i class="fas fa-fw fa-chevron-circle-up fa-2x"></i>
</a>
<script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb19b4fde14befc"></script></body>
</html>
