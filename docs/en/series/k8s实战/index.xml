<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>k8så®æˆ˜ on ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³</title>
    <link>https://xuzhijvn.github.io/en/series/k8s%E5%AE%9E%E6%88%98/</link>
    <description>Recent content in k8så®æˆ˜ on ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡³</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2016-{year} Razon Yang. All Rights Reserved.</copyright>
    <lastBuildDate>Sun, 15 May 2022 14:46:38 +0800</lastBuildDate><atom:link href="https://xuzhijvn.github.io/en/series/k8s%E5%AE%9E%E6%88%98/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Yshop K8s</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/yshop-k8s/</link>
      <pubDate>Sun, 15 May 2022 14:46:38 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/yshop-k8s/</guid>
      <description></description>
    </item>
    
    <item>
      <title>ingress</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/ingress/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/ingress/</guid>
      <description>1. ingressæ˜¯ä»€ä¹ˆ ingressæ˜¯k8sä¸€ç§èµ„æºå¯¹è±¡ï¼Œå¦‚k8sçš„Deploymentã€Serviceèµ„æºå¯¹è±¡ä¸€æ ·ã€‚å®ƒæ˜¯ä¸€ç§é›†ç¾¤ç»´åº¦æš´éœ²æœåŠ¡çš„æ–¹å¼ï¼Œæ­£å¦‚k8sçš„ClusterIPã€NodePortã€LoadBalanceä¸€æ ·ï¼Œä½†æ˜¯ClusterIPçš„æ–¹å¼åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼ŒNodePortæ–¹å¼çš„è¯ï¼Œæµ‹è¯•ç¯å¢ƒä½¿ç”¨è¿˜è¡Œï¼Œå½“æœ‰å‡ åä¸Šç™¾çš„æœåŠ¡åœ¨é›†ç¾¤ä¸­è¿è¡Œæ—¶ï¼ŒNodePortçš„ç«¯å£ç®¡ç†æ˜¯ç¾éš¾ï¼ŒLoadBalanceæ–¹å¼å—é™äºäº‘å¹³å°ï¼Œä¸”é€šå¸¸åœ¨äº‘å¹³å°éƒ¨ç½²ELBè¿˜éœ€è¦é¢å¤–çš„è´¹ç”¨ã€‚ingressè§„åˆ™æ˜¯å¾ˆçµæ´»çš„ï¼Œå¯ä»¥æ ¹æ®ä¸åŒåŸŸåã€ä¸åŒpathè½¬å‘è¯·æ±‚åˆ°ä¸åŒçš„serviceï¼Œå¹¶ä¸”æ”¯æŒhttps/httpã€‚
2. ingressä¸ingress-controller è¦ç†è§£ingressï¼Œéœ€è¦åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µï¼Œingresså’Œingress-controllerï¼š
ingressï¼šæŒ‡çš„æ˜¯k8sä¸­çš„ä¸€ä¸ªapiå¯¹è±¡ï¼Œä¸€èˆ¬ç”¨yamlé…ç½®ã€‚ä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°serviceçš„è§„åˆ™ï¼Œå¯ä»¥ç†è§£ä¸ºé…ç½®æ¨¡æ¿ã€‚ ingress-controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ã€‚ ç®€å•æ¥è¯´ï¼Œingress-controlleræ‰æ˜¯è´Ÿè´£å…·ä½“è½¬å‘çš„ç»„ä»¶ï¼Œé€šè¿‡å„ç§æ–¹å¼å°†å®ƒæš´éœ²åœ¨é›†ç¾¤å…¥å£ï¼Œå¤–éƒ¨å¯¹é›†ç¾¤çš„è¯·æ±‚æµé‡ä¼šå…ˆåˆ°ingress-controllerï¼Œè€Œingresså¯¹è±¡æ˜¯ç”¨æ¥å‘Šè¯‰ingress-controllerè¯¥å¦‚ä½•è½¬å‘è¯·æ±‚ï¼Œæ¯”å¦‚å“ªäº›åŸŸåå“ªäº›pathè¦è½¬å‘åˆ°å“ªäº›æœåŠ¡ç­‰ç­‰ã€‚
2.1 ingress ingressæ˜¯ä¸€ä¸ªAPIå¯¹è±¡ï¼Œå’Œå…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œé€šè¿‡yamlæ–‡ä»¶æ¥é…ç½®ã€‚ingressé€šè¿‡httpæˆ–httpsæš´éœ²é›†ç¾¤å†…éƒ¨serviceï¼Œç»™serviceæä¾›å¤–éƒ¨URLã€è´Ÿè½½å‡è¡¡ã€SSL/TLSèƒ½åŠ›ä»¥åŠåŸºäºhostçš„æ–¹å‘ä»£ç†ã€‚ingressè¦ä¾é ingress-controlleræ¥å…·ä½“å®ç°ä»¥ä¸ŠåŠŸèƒ½ã€‚å‰ä¸€å°èŠ‚çš„å›¾å¦‚æœç”¨ingressæ¥è¡¨ç¤ºï¼Œå¤§æ¦‚å°±æ˜¯å¦‚ä¸‹é…ç½®ï¼š
apiVersion: extensions/v1beta1 kind: Ingress metadata: name: abc-ingress annotations: kubernetes.io/ingress.class: &amp;#34;nginx&amp;#34; nginx.ingress.kubernetes.io/use-regex: &amp;#34;true&amp;#34; spec: tls: - hosts: - api.abc.com secretName: abc-tls rules: - host: api.abc.com http: paths: - backend: serviceName: apiserver servicePort: 80 - host: www.abc.com http: paths: - path: /image/* backend: serviceName: fileserver servicePort: 80 - host: www.abc.com http: paths: - backend: serviceName: feserver servicePort: 8080 2.2 ingress-controller ingress-controllerå¹¶ä¸æ˜¯k8sè‡ªå¸¦çš„ç»„ä»¶ï¼Œå®é™…ä¸Šingress-controlleråªæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„ingress-controllerå®ç°ï¼Œç›®å‰ï¼Œç”±k8sç»´æŠ¤çš„ingress-controlleråªæœ‰googleäº‘çš„GCEä¸ingress-nginxä¸¤ä¸ªï¼Œå…¶ä»–è¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹ç»´æŠ¤çš„ingress-controllerï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ä½†æ˜¯ä¸ç®¡å“ªä¸€ç§ingress-controllerï¼Œå®ç°çš„æœºåˆ¶éƒ½å¤§åŒå°å¼‚ï¼Œåªæ˜¯åœ¨å…·ä½“é…ç½®ä¸Šæœ‰å·®å¼‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œingress-controllerçš„å½¢å¼éƒ½æ˜¯ä¸€ä¸ªpodï¼Œé‡Œé¢è·‘ç€daemonç¨‹åºå’Œåå‘ä»£ç†ç¨‹åºã€‚daemonè´Ÿè´£ä¸æ–­ç›‘æ§é›†ç¾¤çš„å˜åŒ–ï¼Œæ ¹æ®ingresså¯¹è±¡ç”Ÿæˆé…ç½®å¹¶åº”ç”¨æ–°é…ç½®åˆ°åå‘ä»£ç†ï¼Œæ¯”å¦‚nginx-ingresså°±æ˜¯åŠ¨æ€ç”Ÿæˆnginxé…ç½®ï¼ŒåŠ¨æ€æ›´æ–°upstreamï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™reloadç¨‹åºåº”ç”¨æ–°é…ç½®ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢çš„ä¾‹å­éƒ½ä»¥k8så®˜æ–¹ç»´æŠ¤çš„nginx-ingressä¸ºä¾‹ã€‚</description>
    </item>
    
    <item>
      <title>Javaåº”ç”¨ä»nfsåŠ è½½é…ç½®æ–‡ä»¶</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/java%E5%BA%94%E7%94%A8%E4%BB%8Enfs%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/java%E5%BA%94%E7%94%A8%E4%BB%8Enfs%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</guid>
      <description>Javaåº”ç”¨ä»nfsåŠ è½½é…ç½®æ–‡ä»¶
èƒŒæ™¯ é…ç½®æ–‡ä»¶å˜åŒ–ï¼Œæ— éœ€é‡æ–°æ„å»ºé•œåƒéƒ¨ç½²ã€‚
1. å‡†å¤‡nfs 1ã€å‡†å¤‡å¥½nfsæœåŠ¡å™¨ã€‚å‚è€ƒï¼šnfså®‰è£… çš„nfsæœåŠ¡ç«¯é…ç½®ã€‚ 2ã€k8s nodeèŠ‚ç‚¹å¯ä»¥ä¸å¯ç”¨rpcbindæœåŠ¡ï¼Œä½†æ˜¯å¿…é¡»å®‰è£…nfs-utilsï¼ˆyum install nfs-utilsï¼‰ï¼Œå¦åˆ™nfs-client-provisioner podæ— æ³•å¯åŠ¨ï¼Œå› ä¸ºnfs-client.yamlé‡Œé¢æœ‰nfsçš„ç›¸å…³é…ç½®ï¼Œè€Œè¿™äº›nfsé…ç½®è¦ç”Ÿæ•ˆéœ€ä¾èµ–nfs-utilsã€‚å‚è€ƒï¼šnfså®‰è£… çš„nfså®¢æˆ·ç«¯é…ç½®ã€‚
2. åˆ›å»ºStorageClasså¯¹è±¡ ç†è®ºéƒ¨åˆ†å‚è€ƒï¼šStorageClass
2.1 nfs-client.yaml kind: Deployment apiVersion: apps/v1 metadata: name: nfs-client-provisioner spec: replicas: 1 strategy: type: Recreate selector: matchLabels: app: nfs-client-provisioner template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: quay.io/external_storage/nfs-client-provisioner:latest volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: fuseim.pri/ifs - name: NFS_SERVER value: nfs - name: NFS_PATH value: /mnt/nfs/k8s volumes: - name: nfs-client-root nfs: server: nfs path: /mnt/nfs/k8s k8s nodeèŠ‚ç‚¹å¯ä»¥ä¸å¯ç”¨rpcbindæœåŠ¡ï¼Œä½†å¿…é¡»å®‰è£…nfs-utilsã€‚</description>
    </item>
    
    <item>
      <title>k8séƒ¨ç½²åº”ç”¨(å‰ç«¯é™æ€)</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/k8s%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E9%9D%99%E6%80%81/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/k8s%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E9%9D%99%E6%80%81/</guid>
      <description>k8séƒ¨ç½²åº”ç”¨(å‰ç«¯é™æ€)
0. å‡†å¤‡æ¡ä»¶ éƒ¨ç½²å¥½äº†k8sé›†ç¾¤ï¼Œéƒ¨ç½²å¯ä»¥å‚è€ƒKubernetes: ä»é›¶æ­å»ºK8S åç§° æ•°é‡ IP å¤‡æ³¨ master 1 172.17.0.14 æ“ä½œç³»ç»Ÿ: Linux(centos7, å…¶å®ƒæ“ä½œç³»ç»Ÿä¹Ÿå¯, å®‰è£…è¿‡ç¨‹ç±»ä¼¼, å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£) æœºå™¨é…ç½®: 4C8G node1 1 172.18.0.7 åŒä¸Š node2 1 172.19.0.5 åŒä¸Š åº”ç”¨å·²ç»å®¹å™¨åŒ–ï¼Œå¹¶ä¸Šä¼ åˆ°äº†è¿œç¨‹ä»“åº“ï¼Œç¬”è€…æ˜¯è…¾è®¯äº‘å®¹å™¨ä»“åº“ï¼š ç†è§£k8såŸºç¡€æ¦‚å¿µï¼Œå¯ä»¥å‚è€ƒKubernetes: åŸºç¡€æ¦‚å¿µä»‹ç»
1. æ§åˆ¶å™¨ç®¡ç†Pod 1.1 ç”Ÿæˆdeploymenté…ç½®æ–‡ä»¶ kubectl create deployment yshop-h5 --image=ccr.ccs.tencentyun.com/yshop/h5 --dry-run -o yaml &amp;gt; yshop-h5.yaml è¿™ä¸ªæ—¶å€™k8sè¿˜ä¸èƒ½æ‹‰å–é•œåƒï¼Œéœ€è¦ç”Ÿæˆæ‹‰å–é•œåƒçš„å¯†é’¥ã€‚
1.2 ç”Ÿæˆæ‹‰å–é•œåƒçš„å¯†é’¥ kubectl create secret docker-registry registry-secret-tencent --docker-server=ccr.ccs.tencentyun.com --docker-username=è…¾è®¯äº‘è´¦æˆ·ID --docker-password=è…¾è®¯äº‘å®¹å™¨ä»“åº“å¯†ç  &amp;ndash;docker-server: ä»“åº“åœ°å€ &amp;ndash;docker-username: ä»“åº“ç™»é™†è´¦å· &amp;ndash;docker-password: ä»“åº“ç™»é™†å¯†ç  &amp;ndash;docker-email: é‚®ä»¶åœ°å€(é€‰å¡«) -n å‘½åç©ºé—´(é€‰å¡«)
å¯ä»¥è¿è¡Œï¼škubectl get secret registry-secret-tencent --output=yaml æŸ¥çœ‹ç”Ÿæˆçš„å¯†é’¥</description>
    </item>
    
    <item>
      <title>nfså®‰è£…</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/nfs%E5%AE%89%E8%A3%85/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/nfs%E5%AE%89%E8%A3%85/</guid>
      <description>nfså®‰è£…
1. ç¯å¢ƒè¯´æ˜ è§’è‰² ip os NFS æœåŠ¡ç«¯ 172.31.0.12 CentOS 7.6 NFS å®¢æˆ·ç«¯ 172.18.0.7 CentOS 7.6 2. NFS æœåŠ¡ç«¯ 2.1 å®‰è£… nfs-utils # rpcbind ä½œä¸ºä¾èµ–ä¼šè‡ªåŠ¨å®‰è£…ã€‚ &amp;gt; yum install nfs-utils 2.2 é…ç½®å¹¶å¯åŠ¨æœåŠ¡ å…è®¸rpcbind.serviceã€nfs.serviceå¼€æœºè‡ªå¯ï¼š
# å¯åŠ¨ç›¸å…³æœåŠ¡ &amp;gt; systemctl start rpcbind &amp;gt; systemctl start nfs é˜²ç«å¢™å…è®¸æœåŠ¡é€šè¿‡ï¼š
# é˜²ç«å¢™å…è®¸æœåŠ¡é€šè¿‡ &amp;gt; firewall-cmd --zone=public --permanent --add-service={rpc-bind,mountd,nfs} success &amp;gt; firewall-cmd --reload success æˆ–è€…ç›´æ¥å…³é—­é˜²ç«å¢™ï¼šsystemctl stop firewalld
2.3 é…ç½®å…±äº«ç›®å½• ä¾‹å¦‚éœ€è¦å…±äº«çš„ç›®å½•ä¸º/mnt/nfs/ï¼š
# åˆ›å»º /mnt/kvm å¹¶ä¿®æ”¹æƒé™ &amp;gt; cd /mnt /mnt &amp;gt; mkdir nfs /mnt &amp;gt; chmod 755 nfs # éªŒè¯ç›®å½•æƒé™ /mnt &amp;gt; ls -l total 0 drwxr-xr-x 2 root root 59 Oct 17 17:49 nfs ä¹‹åä¿®æ”¹/etc/exportsï¼Œå°†/mnt/nfs/æ·»åŠ è¿›å»ï¼š</description>
    </item>
    
    <item>
      <title>operatorå®æˆ˜</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/operator%E5%AE%9E%E6%88%98/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/operator%E5%AE%9E%E6%88%98/</guid>
      <description>operatorå®æˆ˜ 1âƒ£ï¸ éœ€æ±‚ æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª crd ï¼Œspec åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
Replicas	# å‰¯æœ¬æ•° Image	# é•œåƒ Resources	# èµ„æºé™åˆ¶ Envs	# ç¯å¢ƒå˜é‡ Ports	# æœåŠ¡ç«¯å£ 2âƒ£ï¸ ç¼–ç  åˆå§‹åŒ–é¡¹ç›®ç›®å½•ï¼š
tony@192 k8s % pwd /Users/tony/workspace/k8s tony@192 k8s % mkdir -p app-operator/src/github.com/xuzhijvn/app cd app-operator/src/github.com/xuzhijvn/app åˆå§‹åŒ–operatoré¡¹ç›®ç»“æ„ï¼Œå¹¶åˆ›å»ºapiï¼š
operator-sdk init --domain=huolala.cn --repo=github.com/xuzhijvn/app operator-sdk create api --group app --version v1 --kind App --resource=true --controller=true ä¿®æ”¹ CRD ç±»å‹å®šä¹‰ä»£ç  api/v1/app_types.go:
/* Copyright 2021. Licensed under the Apache License, Version 2.0 (the &amp;#34;License&amp;#34;); you may not use this file except in compliance with the License.</description>
    </item>
    
    <item>
      <title>pvcä¸ä¼šä¸»åŠ¨å›æ”¶é—®é¢˜</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/pvc%E4%B8%8D%E4%BC%9A%E4%B8%BB%E5%8A%A8%E5%9B%9E%E6%94%B6%E9%97%AE%E9%A2%98/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/pvc%E4%B8%8D%E4%BC%9A%E4%B8%BB%E5%8A%A8%E5%9B%9E%E6%94%B6%E9%97%AE%E9%A2%98/</guid>
      <description>pvcä¸ä¼šä¸»åŠ¨å›æ”¶é—®é¢˜
ä½¿ç”¨k8séƒ¨ç½²nacosçš„æ—¶å€™å‘ç°ï¼Œé€šè¿‡volumeClaimTemplatesé…ç½®çš„pvcä¸ä¼šéšç€ä½¿ç”¨kubectl delete -f xxx.yaml åˆ é™¤StatefulSetçš„æ—¶å€™ä¸€åŒè¢«åˆ é™¤ã€‚nacos-pvc-nfs.yamlæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š
--- apiVersion: v1 kind: Service metadata: name: nacos-headless labels: app: nacos annotations: service.alpha.kubernetes.io/tolerate-unready-endpoints: &amp;#34;true&amp;#34; spec: ports: - port: 8848 name: server targetPort: 8848 - port: 7848 name: rpc targetPort: 7848 clusterIP: None selector: app: nacos --- apiVersion: v1 kind: ConfigMap metadata: name: nacos-cm data: mysql.db.name: &amp;#34;nacos_devtest&amp;#34; mysql.port: &amp;#34;3306&amp;#34; mysql.user: &amp;#34;nacos&amp;#34; mysql.password: &amp;#34;nacos&amp;#34; --- apiVersion: apps/v1 kind: StatefulSet metadata: name: nacos spec: serviceName: nacos-headless replicas: 3 template: metadata: labels: app: nacos annotations: pod.</description>
    </item>
    
    <item>
      <title>ä»é›¶æ­å»ºK8S</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BAk8s/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BAk8s/</guid>
      <description>ä»é›¶æ­å»ºK8S
æœºå™¨å‡†å¤‡ åç§° æ•°é‡ IP å¤‡æ³¨ master 1 172.17.0.14 æ“ä½œç³»ç»Ÿ: Linux(centos7, å…¶å®ƒæ“ä½œç³»ç»Ÿä¹Ÿå¯, å®‰è£…è¿‡ç¨‹ç±»ä¼¼, å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£) æœºå™¨é…ç½®: 4C8G node1 1 172.18.0.7 åŒä¸Š node2 1 172.19.0.5 åŒä¸Š ç”±äºæœ¬äººå¾ˆç©·ï¼Œè¿™å‡ å°æœºå™¨æ˜¯åˆ†åˆ«å±äºä¸åŒçš„è…¾è®¯äº‘è´¦å·ï¼Œä¸åŒçš„è´¦å·ä¹‹é—´ä¸èƒ½å†…ç½‘é€šä¿¡ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡å»ºç«‹â€œå¯¹ç­‰è¿æ¥â€å®ç°é€šä¿¡ï¼Œæ¯”ç›´æ¥ç”¨å…¬ç½‘é€šä¿¡é è°±ã€‚
1. ä¿®æ”¹hostname [root@k8s-master ~]$ vim /etc/hostname # ä¿®æ”¹hostname [root@k8s-master ~]$ vim /etc/hosts	# å°†æœ¬æœºIPæŒ‡å‘hostname [root@k8s-master ~]$ reboot -h # é‡å¯(å¯ä»¥åšå®Œå…¨éƒ¨å‰æœŸå‡†å¤‡åå†é‡å¯) ä¿®æ”¹åï¼š
[root@k8s-master ~]# cat /etc/hosts ::1 VM_0_5_centos VM_0_5_centos ::1 localhost.localdomain localhost ::1 localhost6.localdomain6 localhost6 127.0.0.1 localhost localhost.localdomain k8s-master 172.17.0.14 k8s-master 172.18.0.7 k8s-node1 172.19.0.5 k8s-node2 2. é…ç½®é˜²ç«å¢™ ç¬”è€…å›¾æ–¹ä¾¿, ç›´æ¥å…³é—­äº†é˜²ç«å¢™.</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨kubeadmæ›´æ–°k8sè¯ä¹¦</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E4%BD%BF%E7%94%A8kubeadm%E6%9B%B4%E6%96%B0k8s%E8%AF%81%E4%B9%A6/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E4%BD%BF%E7%94%A8kubeadm%E6%9B%B4%E6%96%B0k8s%E8%AF%81%E4%B9%A6/</guid>
      <description>ä½¿ç”¨kubeadmæ›´æ–°k8sè¯ä¹¦ ä»Šå¤©æ“ä½œk8sçš„æ—¶å€™ï¼Œçªç„¶è¯´è¯ä¹¦æ— æ•ˆï¼š
Unable to connect to the server: x509: certificate has expired or is not yet valid é€šè¿‡ kubeadm alpha certs check-expiration æŸ¥çœ‹ï¼Œç¡®å®æ˜¯è¿‡æœŸäº†ï¼š
[root@k8s-master ~]# kubeadm alpha certs check-expiration [check-expiration] Reading configuration from the cluster... [check-expiration] FYI: You can look at this config file with &amp;#39;kubectl -n kube-system get cm kubeadm-config -oyaml&amp;#39; [check-expiration] Error reading configuration from the Cluster. Falling back to default configuration W0627 11:21:35.745166 8754 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.</description>
    </item>
    
    <item>
      <title>åˆ‡æ¢namespace</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%88%87%E6%8D%A2namespace/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%88%87%E6%8D%A2namespace/</guid>
      <description>åˆ‡æ¢namespace
0. èƒŒæ™¯ k8så¦‚ä½•åˆ‡æ¢namespaceï¼Ÿï¼Ÿè€Œä¸å¿…æ¯æ¬¡æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™åœ¨åé¢æŒ‡å®šnamespaceï¼Ÿk8så¹¶æ²¡æœ‰ç›´æ¥æä¾›åˆ‡æ¢namespaceçš„å‘½ä»¤ã€‚ä¸è¿‡å¯ä»¥é€šè¿‡ï¼š
åˆ‡æ¢contextè¾¾åˆ°åˆ‡æ¢namespaceçš„ç›®çš„ï¼Œè¿™éœ€è¦æå‰åˆ›å»ºå¥½contextå’Œnamespaceçš„ç»‘å®šå…³ç³»ï¼ˆå¦‚ï¼škubectl config set-context test --namespace=testï¼‰,ç„¶åä½¿ç”¨ kubectl config use-context test åˆ‡æ¢contextï¼Œä»è€Œé—´æ¥çš„è¾¾åˆ°åˆ‡æ¢namespaceçš„ç›®çš„ã€‚è¿™æ–¹æ³•å±å®æ˜¯å¤ªåˆ«æ‰­äº†ï¼Œå¼ºè¿«ç—‡æ‚£è€…éƒ½ä¸å–œæ¬¢ã€‚ æˆ–è€…ä½¿ç”¨kubectxå·¥å…·ï¼Œå…¶æœ¬è´¨æ˜¯åŠ¨æ€çš„ä¿®æ”¹contextå’Œnamespaceçš„ç»‘å®šå…³ç³»ã€‚ä½¿ç”¨å½¢å¦‚ï¼škubens test å³å¯åˆ‡æ¢ã€‚è¿™æ ·æ‰æ˜¯åˆ‡æ¢namespaceçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼Œä¼˜é›…å¤šäº†ã€‚ å‚è€ƒèµ„æ–™ï¼š Kuberneteså‘½åç©ºé—´
ä¸€æ¡å‘½ä»¤è§£å†³Kubernetesæ›´æ”¹é»˜è®¤çš„namespace
Kubernetes åˆ‡æ¢contextå’Œnamespace
k8sé›†ç¾¤namespaceå’Œcontextä½¿ç”¨
ahmetb / kubectx
æé«˜æ‚¨çš„kubectlç”Ÿäº§åŠ›ï¼ˆç¬¬ä¸‰éƒ¨åˆ†ï¼‰ï¼šé›†ç¾¤ä¸Šä¸‹æ–‡åˆ‡æ¢ã€ä½¿ç”¨åˆ«åå‡å°‘è¾“å…¥å’Œæ’ä»¶æ‰©å±•</description>
    </item>
    
    <item>
      <title>åŒæ­¥é•œåƒåˆ°è‡ªå·±çš„ä»“åº“</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%90%8C%E6%AD%A5%E9%95%9C%E5%83%8F%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%93%E5%BA%93/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%90%8C%E6%AD%A5%E9%95%9C%E5%83%8F%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%93%E5%BA%93/</guid>
      <description>åŒæ­¥é•œåƒåˆ°è‡ªå·±çš„ä»“åº“ ç»å¸¸æœ‰ä¸€äº›å›½å¤–çš„é•œåƒä»“åº“ï¼Œåœ¨å›½å†…æ— æ³•æ‹‰å–ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å…ˆæ‰¾å°å›½å¤–çš„æœåŠ¡å™¨æ‹‰å–ä¸‹æ¥ï¼Œé‡æ–°æ‰“tagåæ¨é€åˆ°è‡ªå·±çš„é•œåƒä»“åº“ã€‚
1âƒ£ï¸ å…è´¹æœåŠ¡å™¨
https://labs.play-with-k8s.com/
ä¸Šé¢k8sçš„æœåŠ¡å™¨ç¡¬ç›˜ä¸å¤Ÿå¤§ï¼Œå¯èƒ½ä¼šæ‹‰é•œåƒå¤±è´¥ï¼Œå»ºè®®ç”¨ä¸‹é¢è¿™ä¸ªï¼š
https://labs.play-with-docker.com/
2âƒ£ï¸ æ‹‰å–-æ‰“tag-æ¨é€
3âƒ£ï¸ éªŒè¯
å‚è€ƒé“¾æ¥ğŸ”— å¦‚ä½•æ‹‰å–k8s.grc.ioã€quay.ioçš„é•œåƒ</description>
    </item>
    
    <item>
      <title>åœ¨namespaceä¹‹é—´å…±äº«secret</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%9C%A8namespace%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%ABsecret/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E5%9C%A8namespace%E4%B9%8B%E9%97%B4%E5%85%B1%E4%BA%ABsecret/</guid>
      <description>åœ¨namespaceä¹‹é—´å…±äº«secret
æœ‰çš„æ—¶å€™åœ¨defaultç©ºé—´ä¸‹åˆ›å»ºäº†æ‹‰å–é•œåƒçš„secretï¼Œå½“éƒ¨ç½²k8sçš„èµ„æºåˆ°å…¶ä»–namespaceçš„æ—¶å€™ï¼Œå¦‚æœéƒ¨ç½²çš„çš„æ˜¯deploymentçš„ä¹‹ç±»çš„åŠ¿å¿…ä¼šè¦æ‹‰å–é•œåƒï¼Œè¿™ä¸ªæ—¶å€™å¿…ç„¶å¤±è´¥ï¼Œå› ä¸ºsecretåˆ›å»ºåœ¨defaultç©ºé—´ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†secretå¤åˆ¶ä¸€ä»½åˆ°éœ€è¦çš„namespaceä¸‹é¢ï¼š
kubectl get secret coding-regcred --namespace=default -oyaml | grep -v &amp;#39;^\s*namespace:\s&amp;#39; | kubectl apply --namespace=tkb -f - å‚è€ƒé“¾æ¥ï¼šKubernetes - sharing secret across namespaces</description>
    </item>
    
    <item>
      <title>æœ¬åœ°è¿æ¥k8sé›†ç¾¤</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E6%9C%AC%E5%9C%B0%E8%BF%9E%E6%8E%A5k8s%E9%9B%86%E7%BE%A4/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E6%9C%AC%E5%9C%B0%E8%BF%9E%E6%8E%A5k8s%E9%9B%86%E7%BE%A4/</guid>
      <description>æœ¬åœ°è¿æ¥k8sé›†ç¾¤ åœ¨æ—¥å¸¸å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šéœ€è¦åœ¨æœ¬åœ°å¼€å‘çš„ç¨‹åºéœ€è¦åœ¨k8sä¸­è°ƒè¯•çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œå†™äº†ä¸€ä¸ªoperatorã€‚
å¦‚æœæ­¤æ—¶ï¼Œæœ¬åœ°åˆæ²¡æœ‰å¯ä»¥ç›´æ¥å¯è¾¾çš„k8sé›†ç¾¤ï¼Œ
æ¯”å¦‚k8sæ˜¯åœ¨å…¬æœ‰äº‘çš„vpcç¯å¢ƒå†…ï¼Œå¤–é¢æ— æ³•ç›´æ¥è®¿é—®ã€‚æƒ³è¦æœ¬åœ°è¿æ¥è¿œç¨‹k8sé›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒ æœ¬åœ°è¿æ¥è¿œç¨‹çš„å†…ç½‘k8sé›†ç¾¤
å†æ¯”å¦‚k8sé›†ç¾¤æ˜¯è‡ªå·±é€šè¿‡å¤šå°äº‘æœåŠ¡å™¨è‡ªè¡Œæ­å»ºçš„ï¼ŒmasterèŠ‚ç‚¹æœ‰è‡ªå·±çš„å…¬ç½‘ipã€‚æƒ³è¦æœ¬åœ°è¿æ¥è¿œç¨‹k8sé›†ç¾¤ï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡ã€‚
1âƒ£ï¸ é‡æ–°ç”Ÿæˆconfigæ–‡ä»¶ é»˜è®¤ä¸‹ï¼Œ~/.kube/config ç”Ÿæˆé…ç½®æ–‡ä»¶çš„æ—¶å€™åªåŒ…å«äº†k8sé›†ç¾¤ipå’Œè¿™ä¸ªèŠ‚ç‚¹çš„å±€åŸŸç½‘ipï¼Œæœ¬åœ°å¦‚æœæƒ³è¿œç¨‹æ“ä½œk8sçš„è¯ï¼Œå¿…å®šè¦é€šè¿‡å…¬ç½‘ipè¿æ¥åˆ°k8sé›†ç¾¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠèŠ‚ç‚¹ç»‘å®šçš„å…¬ç½‘ipä¹Ÿæ”¾åˆ°è¯ä¹¦é‡Œé¢å»ï¼Œå³æˆ‘ä»¬éœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œæœ¬åœ°ç›´æ¥è®¿é—®çš„è¯ï¼Œä¼šæŠ¥å¦‚ä¸‹æç¤ºï¼š
tony@192 ~ % kubectl get pod Unable to connect to the server: x509: certificate is valid for 10.96.0.1, 172.17.0.14, not 106.55.152.92 å…ˆå¤‡ä»½è¯ä¹¦ï¼š
[root@k8s-master .kube]# mkdir -p /etc/kubernetes/pki.bak [root@k8s-master .kube]# mv /etc/kubernetes/pki/apiserver.* /etc/kubernetes/pki.bak é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼š
[root@k8s-master .kube]# kubeadm init phase certs all --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=10.96.0.1,172.17.0.14,xxx.xxx.xxx.xxx(å…¬ç½‘ip) I0627 15:10:39.069106 7777 version.go:252] remote version is much newer: v1.21.2; falling back to: stable-1.18 W0627 15:10:40.982380 7777 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.</description>
    </item>
    
    <item>
      <title>éƒ¨ç½²sentinel-dashboard</title>
      <link>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E9%83%A8%E7%BD%B2sentinel-dashboard/</link>
      <pubDate>Fri, 27 Aug 2021 11:15:10 +0800</pubDate>
      
      <guid>https://xuzhijvn.github.io/en/zh-cn/posts/k8s/%E5%AE%9E%E6%88%98/%E9%83%A8%E7%BD%B2sentinel-dashboard/</guid>
      <description>éƒ¨ç½²sentinel-dashboard
1. æ„å»ºé•œåƒ FROM openjdk:8-jdk-alpine VOLUME /tmp ADD sentinel-dashboard-1.8.0.jar sentinel-dashboard.jar CMD java ${JAVA_OPTS} -jar sentinel-dashboard.jar EXPOSE 8718 2. åˆ›å»ºheadless service apiVersion: v1 kind: Service metadata: name: sentinel-headless labels: app: sentinel annotations: service.alpha.kubernetes.io/tolerate-unready-endpoints: &amp;#34;true&amp;#34; spec: ports: - port: 8718 name: server targetPort: 8718 clusterIP: None selector: app: sentinel 3. åˆ›å»ºStatefulSet apiVersion: apps/v1 kind: StatefulSet metadata: name: sentinel spec: serviceName: sentinel replicas: 1 template: metadata: labels: app: sentinel annotations: pod.alpha.kubernetes.io/initialized: &amp;#34;true&amp;#34; spec: containers: - name: sentinel imagePullPolicy: IfNotPresent image: ccr.</description>
    </item>
    
  </channel>
</rss>
