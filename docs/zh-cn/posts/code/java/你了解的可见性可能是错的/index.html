<!doctype html><html lang="zh-cn"
  >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>你了解的可见性可能是错的 - 🇨🇳🇨🇳🇨🇳🇨🇳🇨🇳</title><link rel="apple-touch-icon" href="https://xuzhijvn.github.io/images/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="https://xuzhijvn.github.io/images/favicons/manifest.json">
<link rel="icon" href="https://xuzhijvn.github.io/images/favicons/favicon.ico">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="你了解的可见性可能是错的">
<meta itemprop="description" content="背景 这篇文章最开始再我的群里面有讨论过，当时想写的这篇文章的，但是因为一些时间的关系所以便没有写。最近阅读微信文章的时候发现了一篇零度写的一篇文章《分享一道阿里Java并发面试题》，对于有关Java并发性技术的文章我一般还是挺感兴趣的，于是阅读了一下，整体来说还是挺不错的，但是其中犯了一个验证可见性的问题。由于微信文章回复不方便讨论，于是我便把之前一些和群友的讨论在这里写出来。
如何测试可见性问题 因为在群里面我们习惯的有每周一问，也就由我或者群友发现一些由意思的问题然后提问给大家，让大家参与讨论，当时我提出了一个如何测试vlolatile可见性的问题，首先在Effective Java给出了一个测试volatile可见性的例子:
import java.util.concurrent.*; public class Test { private static /*volatile*/ boolean stop = false; public static void main(String[] args) throws Exception { Thread t = new Thread(new Runnable() { public void run() { int i = 0; while (!stop) { i&#43;&#43;; // System.out.println(&#34;hello&#34;);  } } }); t.start(); Thread.sleep(1000); TimeUnit.SECONDS.sleep(1); System.out.println(&#34;Stop Thread&#34;); stop = true; } } 这里大家可以复制上面的代码，你会发现这里程序永远不会结束，在零度的那篇文章中也给出了一个测试可见性的例子:
public class ThreadSafeCache { int result; public int getResult() { return result; } public synchronized void setResult(int result) { this."><meta itemprop="datePublished" content="2021-08-27T11:15:10+08:00" />
<meta itemprop="dateModified" content="2021-08-27T11:15:10+08:00" />
<meta itemprop="wordCount" content="313"><meta itemprop="image" content="https://xuzhijvn.github.io/images/center.png">
<meta itemprop="keywords" content="Java," /><meta property="og:title" content="你了解的可见性可能是错的" />
<meta property="og:description" content="背景 这篇文章最开始再我的群里面有讨论过，当时想写的这篇文章的，但是因为一些时间的关系所以便没有写。最近阅读微信文章的时候发现了一篇零度写的一篇文章《分享一道阿里Java并发面试题》，对于有关Java并发性技术的文章我一般还是挺感兴趣的，于是阅读了一下，整体来说还是挺不错的，但是其中犯了一个验证可见性的问题。由于微信文章回复不方便讨论，于是我便把之前一些和群友的讨论在这里写出来。
如何测试可见性问题 因为在群里面我们习惯的有每周一问，也就由我或者群友发现一些由意思的问题然后提问给大家，让大家参与讨论，当时我提出了一个如何测试vlolatile可见性的问题，首先在Effective Java给出了一个测试volatile可见性的例子:
import java.util.concurrent.*; public class Test { private static /*volatile*/ boolean stop = false; public static void main(String[] args) throws Exception { Thread t = new Thread(new Runnable() { public void run() { int i = 0; while (!stop) { i&#43;&#43;; // System.out.println(&#34;hello&#34;);  } } }); t.start(); Thread.sleep(1000); TimeUnit.SECONDS.sleep(1); System.out.println(&#34;Stop Thread&#34;); stop = true; } } 这里大家可以复制上面的代码，你会发现这里程序永远不会结束，在零度的那篇文章中也给出了一个测试可见性的例子:
public class ThreadSafeCache { int result; public int getResult() { return result; } public synchronized void setResult(int result) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xuzhijvn.github.io/zh-cn/posts/code/java/%E4%BD%A0%E4%BA%86%E8%A7%A3%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E5%8F%AF%E8%83%BD%E6%98%AF%E9%94%99%E7%9A%84/" /><meta property="og:image" content="https://xuzhijvn.github.io/images/center.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-27T11:15:10+08:00" />
<meta property="article:modified_time" content="2021-08-27T11:15:10+08:00" />
<meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/code/redis/redis%E4%BA%8B%E5%8A%A1/" /><meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/sa/rpc%E7%BB%BC%E8%BF%B0/" /><meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/code/java/java%E5%BA%8F%E5%88%97%E5%8C%96/" /><meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/code/java/%E5%87%A0%E7%A7%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/" /><meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/code/mysql/mysql%E5%AE%9E%E9%AA%8C/" /><meta property="og:see_also" content="https://xuzhijvn.github.io/zh-cn/posts/code/java/reactive-streams/" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://xuzhijvn.github.io/images/center.png"/>

<meta name="twitter:title" content="你了解的可见性可能是错的"/>
<meta name="twitter:description" content="背景 这篇文章最开始再我的群里面有讨论过，当时想写的这篇文章的，但是因为一些时间的关系所以便没有写。最近阅读微信文章的时候发现了一篇零度写的一篇文章《分享一道阿里Java并发面试题》，对于有关Java并发性技术的文章我一般还是挺感兴趣的，于是阅读了一下，整体来说还是挺不错的，但是其中犯了一个验证可见性的问题。由于微信文章回复不方便讨论，于是我便把之前一些和群友的讨论在这里写出来。
如何测试可见性问题 因为在群里面我们习惯的有每周一问，也就由我或者群友发现一些由意思的问题然后提问给大家，让大家参与讨论，当时我提出了一个如何测试vlolatile可见性的问题，首先在Effective Java给出了一个测试volatile可见性的例子:
import java.util.concurrent.*; public class Test { private static /*volatile*/ boolean stop = false; public static void main(String[] args) throws Exception { Thread t = new Thread(new Runnable() { public void run() { int i = 0; while (!stop) { i&#43;&#43;; // System.out.println(&#34;hello&#34;);  } } }); t.start(); Thread.sleep(1000); TimeUnit.SECONDS.sleep(1); System.out.println(&#34;Stop Thread&#34;); stop = true; } } 这里大家可以复制上面的代码，你会发现这里程序永远不会结束，在零度的那篇文章中也给出了一个测试可见性的例子:
public class ThreadSafeCache { int result; public int getResult() { return result; } public synchronized void setResult(int result) { this."/>
<meta name="twitter:site" content="@razonyang"/>
<link rel="preload" href="https://xuzhijvn.github.io/css/bundle.min.3cecd960b71660d3d8ac067f39179d263d479ccac6af4dd6965d97a6a0a00962.css" integrity="sha256-POzZYLcWYNPYrAZ/ORedJj1HnMrGr03Wll2XpqCgCWI=" crossorigin="anonymous" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://xuzhijvn.github.io/css/bundle.min.3cecd960b71660d3d8ac067f39179d263d479ccac6af4dd6965d97a6a0a00962.css" integrity="sha256-POzZYLcWYNPYrAZ/ORedJj1HnMrGr03Wll2XpqCgCWI=" crossorigin="anonymous"></noscript></head>
  <body><script src="https://xuzhijvn.github.io/js/bootstrap.min.b5d86dd3a5f60c90be38a252bb65fc1a2732f32e71dc12c051720f0c7aef3cde.js" integrity="sha256-tdht06X2DJC&#43;OKJSu2X8Gicy8y5x3BLAUXIPDHrvPN4=" crossorigin="anonymous"></script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand me-3" href="https://xuzhijvn.github.io/zh-cn/"><img class="logo" alt="Logo" src="https://xuzhijvn.github.io/images/logo.webp" loading="lazy"
   width="400" height="400"
   />
👴🏻💪
    </a>
    <button class="navbar-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
  aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
  <i class="fas fa-share-alt"></i>
</button>

<div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=%e4%bd%a0%e4%ba%86%e8%a7%a3%e7%9a%84%e5%8f%af%e8%a7%81%e6%80%a7%e5%8f%af%e8%83%bd%e6%98%af%e9%94%99%e7%9a%84&url=https%3a%2f%2fxuzhijvn.github.io%2fzh-cn%2fposts%2fcode%2fjava%2f%25E4%25BD%25A0%25E4%25BA%2586%25E8%25A7%25A3%25E7%259A%2584%25E5%258F%25AF%25E8%25A7%2581%25E6%2580%25A7%25E5%258F%25AF%25E8%2583%25BD%25E6%2598%25AF%25E9%2594%2599%25E7%259A%2584%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fxuzhijvn.github.io%2fzh-cn%2fposts%2fcode%2fjava%2f%25E4%25BD%25A0%25E4%25BA%2586%25E8%25A7%25A3%25E7%259A%2584%25E5%258F%25AF%25E8%25A7%2581%25E6%2580%25A7%25E5%258F%25AF%25E8%2583%25BD%25E6%2598%25AF%25E9%2594%2599%25E7%259A%2584%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">设置</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body"><section class="setting">
  <form class="row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-language"></i> 语言</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="dropdown">
        <a class="btn btn-sm btn-outline-primary dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          简体中文
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown"><li><a class="dropdown-item" href="https://xuzhijvn.github.io/en/"></a></li><li><a class="dropdown-item" href="https://xuzhijvn.github.io/zh-tw/"></a></li></ul>
      </div>
    </div>
  </form>
</section>


<section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> 模式</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> 配色</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="蓝色"
        class="btn btn-sm palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="蓝灰色"
        class="btn btn-sm palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="棕色"
        class="btn btn-sm palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="青色"
        class="btn btn-sm palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="绿色"
        class="btn btn-sm palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="靛青色"
        class="btn btn-sm palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="橙色"
        class="btn btn-sm palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="粉色"
        class="btn btn-sm palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="紫色"
        class="btn btn-sm palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="红色"
        class="btn btn-sm palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="蓝绿色"
        class="btn btn-sm palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="黄色"
        class="btn btn-sm palette" data-palette="yellow">
      </button></div>
</section>
</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="https://xuzhijvn.github.io/zh-cn/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="https://xuzhijvn.github.io/zh-cn/archives/">
            <i class="fas fa-fw fa-file-archive"></i>归档
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-categories" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-folder"></i>分类
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-categories"><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3">
                <i class="fas fa-fw fa-code"></i>编程思想
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">
                <i class="fas fa-fw fa-robot"></i>人工智能
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE">
                <i class="fas fa-fw fa-cubes"></i>区块链
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">
                <i class="fas fa-fw fa-server"></i>计算机科学
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B">
                <i class="fas fa-fw fa-sitemap"></i>架构演进
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F">
                <i class="fas fa-fw fa-cloud"></i>云原生
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/categories">
                <i class="fas fa-fw fa-folder"></i>所有分类
              </a>
            </li></ul>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-tags" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-tags"></i>标签
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-tags"><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/tags/java">
                <i class="fab fa-fw fa-java"></i>Java
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/tags/go">
                <i class="fab fa-fw fa-google"></i>Go
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/tags/mysql">
                <i class="fas fa-fw fa-database"></i>MySQL
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://xuzhijvn.github.io/tags">
                <i class="fas fa-fw fa-tags"></i>所有标签
              </a>
            </li></ul>
        </li><li class="nav-item">
          <a class="nav-link" href="https://xuzhijvn.github.io/series">
            <i class="fas fa-fw fa-columns"></i>专栏
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdown-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            项目
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown-projects"><li>
              <a class="dropdown-item"
                href="https://clevergo.tech/" target="_blank" rel="noopener noreferrer">
                CleverGo
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://gopkgs.net/" target="_blank" rel="noopener noreferrer">
                GOPKGS
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank" rel="noopener noreferrer">
                Hugo Bootstrap 主题
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://admin.yii2.razonyang.com/" target="_blank" rel="noopener noreferrer">
                Yii 2 管理后台
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="https://xuzhijvn.github.io/zh-cn/">主页</a></li><li class="breadcrumb-item"><a href="https://xuzhijvn.github.io/zh-cn/posts/">文章</a></li><li class="breadcrumb-item active">你了解的可见性可能是错的</li></ol>
  </div>
</nav>    <article class="row card component mb-4 post"><div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>
  
    

    <a class="action btn-reward" role="button" data-bs-toggle="modal" data-bs-target="#rewardModal" title="打赏">
  <i class="fas fa-fw fa-coffee"></i>
</a>
    
    <a class="action" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<div class="card-body">
        <h1 class="card-title my-3">你了解的可见性可能是错的
</h1><div class="post-meta"><span class="post-date" title="created on">
    <i class="fas fa-fw fa-calendar-alt"></i>2021-08-27
  </span><span class="post-reading-time" title="reading time">
    <i class="fas fa-fw fa-coffee"></i>2 分钟阅读
  </span><a href="https://xuzhijvn.github.io/zh-cn/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/" class="badge rounded-pill text-white bg-primary post-taxonomy">编程思想</a><a href="https://xuzhijvn.github.io/zh-cn/series/manual/" class="badge rounded-pill text-white bg-primary post-taxonomy">Manual</a><a href="https://xuzhijvn.github.io/zh-cn/tags/java/" class="badge rounded-pill text-white bg-primary post-taxonomy">Java</a></div>
<div class="post-share mb-3"><div class="addthis_inline_share_toolbox"></div></div><div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h2 class="offcanvas-title" id="offcanvasTOCLabel">目录</h5>
      <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#背景">背景</a></li>
        <li><a href="#如何测试可见性问题">如何测试可见性问题</a></li>
        <li><a href="#推翻验证程序">推翻验证程序</a></li>
        <li><a href="#真相大白">真相大白</a></li>
        <li><a href="#总结">总结</a></li>
        <li><a href="#转自">转自</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><h3 id="背景">背景</h3>
<p>这篇文章最开始再我的群里面有讨论过，当时想写的这篇文章的，但是因为一些时间的关系所以便没有写。最近阅读微信文章的时候发现了一篇零度写的一篇文章《分享一道阿里Java并发面试题》，对于有关Java并发性技术的文章我一般还是挺感兴趣的，于是阅读了一下，整体来说还是挺不错的，但是其中犯了一个验证可见性的问题。由于微信文章回复不方便讨论，于是我便把之前一些和群友的讨论在这里写出来。</p>
<h3 id="如何测试可见性问题">如何测试可见性问题</h3>
<p>因为在群里面我们习惯的有每周一问，也就由我或者群友发现一些由意思的问题然后提问给大家，让大家参与讨论，当时我提出了一个如何测试vlolatile可见性的问题，首先在Effective Java给出了一个测试volatile可见性的例子:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.util.concurrent.*<span style="color:#f92672">;</span>  

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span> <span style="color:#f92672">{</span>  
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#75715e">/*volatile*/</span> <span style="color:#66d9ef">boolean</span> stop <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>  
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>  
        Thread t <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Runnable<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>  
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>  
                <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>  
                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>stop<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  
                    i<span style="color:#f92672">++;</span>  
<span style="color:#75715e">//                    System.out.println(&#34;hello&#34;);  
</span><span style="color:#75715e"></span>                <span style="color:#f92672">}</span>  
            <span style="color:#f92672">}</span>  
        <span style="color:#f92672">});</span>  
        t<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>  

        Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>  
        TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>  
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Stop Thread&#34;</span><span style="color:#f92672">);</span>  
        stop <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>  
    <span style="color:#f92672">}</span>  
<span style="color:#f92672">}</span>  
</code></pre></div><p>这里大家可以复制上面的代码，你会发现这里程序永远不会结束，在零度的那篇文章中也给出了一个测试可见性的例子:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThreadSafeCache</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> result<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getResult</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setResult</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> result<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> result<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ThreadSafeCache threadSafeCache <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadSafeCache<span style="color:#f92672">();</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 8<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>threadSafeCache<span style="color:#f92672">.</span><span style="color:#a6e22e">getResult</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    x<span style="color:#f92672">++;</span>
                <span style="color:#f92672">}</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>x<span style="color:#f92672">);</span>
            <span style="color:#f92672">}).</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>

        threadSafeCache<span style="color:#f92672">.</span><span style="color:#a6e22e">setResult</span><span style="color:#f92672">(</span>200<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>这里大家也可以运行一下这里是不会结束的。</p>
<p>然而这两个例子真的是测试可见性的？我们先不着急下定论，首先我们来看看何为可见性，这里为了防止自己的一些片面之词，查阅了一些资料可以发现可见性的定义总体来说可以定义为:</p>
<blockquote>
<p>当一个线程修改了共享变量后，其他线程能够立即得知这个修改。</p>
</blockquote>
<p>可见性的定义比较简单，那怎么去实现呢？一般来说可见性会通过缓存一致性协议来完成，这里有篇文章讲CPU缓存一致性协议讲得不错:https://www.cnblogs.com/yanlong300/p/8986041.html，我这里直接借用他的图片,</p>
<p><img src="https://picgo.6and.ltd/img/aco97-du9wx.jpg" alt="缓存一致性协议" style="zoom: 50%;" /></p>
<ul>
<li>CPU A 计算完成后发指令需要修改x.</li>
<li>CPU A 将x设置为M状态（修改状态）并通知缓存了x的CPU B, CPU B将本地cache b中的x设置为I状态(无效状态)</li>
<li>CPU A 对x进行赋值</li>
<li>CPU B 发现x是失效的这个时候会进行回刷操作</li>
</ul>
<p>可以看见我们的一致性协议会有一定的时间延迟，但是我们的可见性的目的是立即读到最新的，所以我们这里会将无效状态通知到其他拥有该缓存数据的CPU缓存中，并且等待确认，我们vlolatile也是采用这种方式达到可见性的，当然更多的细节你可以直接阅读上面推荐的文章。</p>
<p>我们又回到我们的测试用例，可以发现我们的while循环是一个死循环，但是我们的缓存一致性协议是一定时间延迟，虽然这个一定时间并不保证，但是在现代的电脑系统上尤其是你自己的机器上，刷新一个缓存这点小时间还是有的吧。</p>
<p>并且我们验证可见性的时候似乎违背了我们初衷，可见性的定义是立即读到最新的，但是我们却在强调我们的测试程序会出现死循环，那我们不就是验证的是永远都读不到最新的吗？</p>
<p>通过上面的种种论述我们发现我们可见性的验证似乎出了一点问题。</p>
<h3 id="推翻验证程序">推翻验证程序</h3>
<p>我们这里只需要一行代码就可以推翻我们上面的验证程序，我们用第二个验证程序:</p>
<p><img src="https://picgo.6and.ltd/img/a6oru-dia04-20210908154223291.jpg" alt="第二个验证程序" style="zoom:80%;" /></p>
<p>只添加了一句打印我们的结果值,我们的程序却停止了:</p>
<p><img src="https://picgo.6and.ltd/img/alljf-ijrqt-20210908154256928.jpg" alt="程序却停止" style="zoom:67%;" /></p>
<p>这个结果证明我们的其他线程是能获取到我们的更新后的结果值的，所以这里一定是有其他原因。</p>
<h3 id="真相大白">真相大白</h3>
<p>我们上面添加了一句话，并没有影响我们的逻辑，但是却产生了截然不同的结果，这个到底是怎么回事呢？首先我们能想到的是编译器优化，看看添加代码前和添加代码后，编译器编译之后的代码是什么，由于我们用的是idea直接打开idea的class文件会帮助我们做反编译。</p>
<p>添加代码前:</p>
<p><img src="https://picgo.6and.ltd/img/aroua-cfq0t-20210908154335705.jpg" alt="添加代码前" style="zoom:67%;" /></p>
<p>添加代码后:</p>
<p><img src="https://picgo.6and.ltd/img/aak8e-a0hay-20210908154410072.jpg" alt="添加代码后" style="zoom:67%;" /></p>
<p>这里可以看见编译器已经将我们的while循环优化成for循环，在循环内部添加了一个输出语句，这里可以看见逻辑并没有太大的变化，可以看见不是我们的编译器作怪的问题，这种优化代码的问题还有一个元凶那就是JIT，由于我们的循环有很多次肯定会触发JIT编译优化。</p>
<p>由于JIT编译优化有多个层级，这里我们只看最终的C2优化后的汇编代码,看JIT的汇编代码可以利用hsdis+JITWatch查看，这里我只用了hsdis打印在控制台上查看即可。这里需要添加一下JVM启动参数-XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly，
启动之后一大堆汇编代码，为了看这个查询了好多汇编指令终于是把它理顺了。</p>
<pre><code class="language-assembly" data-lang="assembly">  0x0000000112f81ce8: cmp    $0x64,%r10d
  0x0000000112f81cec: jge    0x0000000112f81cfc  ;*goto
                                                ; - ThreadSafeCache::lambda$main$0@14 (line 29)

  0x0000000112f81cee: inc    %ebx               ; OopMap{rbp=Oop off=80}
                                                ;*goto
                                                ; - ThreadSafeCache::lambda$main$0@14 (line 29)

  0x0000000112f81cf0: test   %eax,-0xb001cf6(%rip)        # 0x0000000107f80000
                                                ;*goto
                                                ; - ThreadSafeCache::lambda$main$0@14 (line 29)
                                                ;   {poll}
  0x0000000112f81cf6: jmp    0x0000000112f81cee
</code></pre><p>上面的这么多行代码都是我们下面:这段代码的翻译:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">                <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>threadSafeCache<span style="color:#f92672">.</span><span style="color:#a6e22e">getResult</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    x<span style="color:#f92672">++;</span>
                <span style="color:#f92672">}</span>
</code></pre></div><p>解释一下汇编的代码:</p>
<ul>
<li>Step 1：比较threadSafeCache.getResult() 和100的大小</li>
<li>Step 2: threadSafeCache.getResult()如果大于等于100，跳转至0x0000000112f81cfc,也就是循环外的代码。</li>
<li>Step 3: 如果小于，那么执行x++操作。</li>
<li>Step 4: 检查安全点checkpoint,这里不是逻辑代码不需要太关注。</li>
<li>Step 5: 跳转至我们的Step3处。</li>
</ul>
<p>可以看见我们上面的代码Step3-5之间形成了死循环，其实我们的代码翻译过来可以看作下面的代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>threadSafeCache<span style="color:#f92672">.</span><span style="color:#a6e22e">getResult</span><span style="color:#f92672">()</span> <span style="color:#f92672">&lt;</span> 100<span style="color:#f92672">){</span>
    <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">){</span>
        x<span style="color:#f92672">++;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>可以看见我们的整段代码只执行了这一次get逻辑，有可能get的时候我们主线程还没有执行set。
为什么里面加了一段打印之后就不会有这样的效果呢？我的猜测是如果在我们print中有sync加锁操作，jit会取消这种激进的优化，当然我们的变量如果是<code>volatile</code>也会有这样的效果，我们添加<code>volatile</code>的jit的汇编代码如下：</p>
<p><img src="https://picgo.6and.ltd/img/a0tyw-koqj3-20210908154514512.jpg" alt="汇编代码" style="zoom:67%;" /></p>
<p>可以发现这里没有做激进的优化而是每次都会获取新的值，来进行比较。</p>
<h3 id="总结">总结</h3>
<p>到最后，我也没有提及，如何去测试可见性，因为这个东西理论上来说无法去测试，因为有一个很重要的一点我们没法确定线程的执行顺序，当然也有确定的方式，那就是加一个同步器，可以是锁，可以是信号量，让我们的读取操作,在我们写操作之后，还有读操作一定是一次，不能使用循环，我尝试着按照这个思路去写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#75715e">/*volatile*/</span> <span style="color:#66d9ef">boolean</span> stop <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        CountDownLatch countDownLatch <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CountDownLatch<span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        Thread t <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Runnable<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>

            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    countDownLatch<span style="color:#f92672">.</span><span style="color:#a6e22e">await</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>stop<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">});</span>
        t<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>

        Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1000<span style="color:#f92672">);</span>
        TimeUnit<span style="color:#f92672">.</span><span style="color:#a6e22e">SECONDS</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Stop Thread&#34;</span><span style="color:#f92672">);</span>
        stop <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        countDownLatch<span style="color:#f92672">.</span><span style="color:#a6e22e">countDown</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>上面这个程序没有加<code>volatile</code>,那么输出结果是有一定可能是false的但是发现，所有结果是true，其实这种方式没法去测试，因为我们外加了同步器而我们的同步器会带来读写屏障的加入，如果是读屏障那么会告诉处理器在执行任何的加载前，先应用所有已经在失效队列中的失效操作的指令，也就是会执行失效，回刷缓存。</p>
<p>所以验证可见性的确没有一个很好的例子，我们只需要知道如果没有其他保障(读写屏障等)，有可能不能获取到最新的数据，但是其最终会获取到更新的数据，这个也很像我们分布式一致性中的最终一致性。</p>
<p>最后大家也可以看看零度的这篇文章：https://mp.weixin.qq.com/s/i9ES7u5MPWCv1n8jYU_q_w，其中的对内存屏障和happens-before也有一定的讲解。</p>
<h3 id="转自">转自</h3>
<p><a href="https://mp.weixin.qq.com/s/3HCWuE4EQNOKbX6G6oOYpQ" target="_blank" rel="noopener noreferrer">你了解的可见性可能是错的！</a>
</p>
</div><div class="modal fade" id="rewardModal" tabindex="-1" aria-labelledby="rewardModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content surface">
      <div class="modal-header">
        <h5 class="modal-title" id="rewardModalLabel"><i class="fas fa-fw fa-coffee"></i>打赏</h5>
        <a href="#" data-bs-dismiss="modal" class="btn btn-sm btn-outline-primary" aria-label="Close"><i class="fas fa-times"></i></a>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs mb-3" role="tablist"><li class="nav-item text-nowrap" role="presentation">
            <a class="nav-link active" id="reward-alipay-tab" data-bs-toggle="tab" href="#reward-alipay" role="tab" aria-controls="reward-alipay" aria-selected="true">
              <i class="fab fa-fw fa-alipay"></i>支付宝
            </a>
          </li><li class="nav-item text-nowrap" role="presentation">
            <a class="nav-link" id="reward-wechat-tab" data-bs-toggle="tab" href="#reward-wechat" role="tab" aria-controls="reward-wechat" aria-selected="true">
              <i class="fab fa-fw fa-weixin"></i>微信
            </a>
          </li></ul>
        <div class="tab-content" id="rewardTabContent"><div class="tab-pane fade post-reward-content show active" id="reward-alipay" role="tabpanel" aria-labelledby="reward-alipay-tab">
            <img class="img-fluid post-reward-img" src="https://xuzhijvn.github.io/images/reward/alipay.png" loading="lazy" />
          </div><div class="tab-pane fade post-reward-content show" id="reward-wechat" role="tabpanel" aria-labelledby="reward-wechat-tab">
            <img class="img-fluid post-reward-img" src="https://xuzhijvn.github.io/images/reward/wechat.png" loading="lazy" />
          </div></div>
      </div>
    </div>
  </div>
</div><hr /><div class="post-navs d-flex mb-3 justify-content-evenly">
  <div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-left"></i>
    <a href="https://xuzhijvn.github.io/zh-cn/posts/k8s/2.%E5%AE%9E%E6%88%98/%E4%BD%BF%E7%94%A8kubeadm%E6%9B%B4%E6%96%B0k8s%E8%AF%81%E4%B9%A6/">使用kubeadm更新k8s证书
</a>
  </div><div class="post-nav post-next">
    <a href="https://xuzhijvn.github.io/zh-cn/posts/k8s/2.%E5%AE%9E%E6%88%98/%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BAk8s/">从零搭建K8S
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div><section class="related-posts-wrapper">
    <h3>相关文章</h3>
    <ul class="related-posts"><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/aqs/">AQS
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/completablefuture%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">CompletableFuture使用详解
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/hashmap%E5%92%8Chashtable%E5%8C%BA%E5%88%AB/">HashMap和HashTable区别
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/jit%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91/">JIT即时编译
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/java-agent/">Java Agent
</a></li></ul>
  </section></div>
    </article><div class="card component row post-comments">
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="razonyang/blog"
  issue-term="pathname"
  label="comment"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container">
    <section class="ad row surface justify-content-center">
  <ins class="adsbygoogle sidebar-ad"
    data-ad-client="ca-pub-7827859788508375"
    data-ad-slot="5059539159"
    data-ad-format="auto"
    data-full-width-responsive="false"></ins>
</section>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <section class="card row text-center profile component">
  <div class="card-body">
    <div class="col-12 d-flex align-items-center justify-content-center"><img class="profile-avatar rounded-circle" alt="Tony" src="https://xuzhijvn.github.io/images/profile.webp" loading="lazy"
   width="400" height="400"
   />
</div>
    <div class="col-12 profile-meta"><div class="profile-name">Tony</div><div class="profile-bio">💇🏻‍♀️👴🏻 发型总监 💇🏻‍♀️👴🏻</div><div class="profile-company"><i class="fas fa-fw fa-building"></i>💈光头发廊💈</div><div class="profile-location"><i class="fas fa-fw fa-map-marker-alt"></i>深圳</div><div class="profile-about"><i class="fas fa-fw fa-user"></i><a href="https://xuzhijvn.github.io/zh-cn/about/">关于</a></div></div>
  </div>
</section>
  <section class="recent-posts row card component">
  <div class="card-body">
    <h2 class="card-title">最近文章</h2>
    <ul><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/java/javaio/">JavaIO
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/cs/tcp/%E9%95%BF%E8%BF%9E%E6%8E%A5%E7%9F%AD%E8%BF%9E%E6%8E%A5/">长连接短连接
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/algorithm/leetcode/%E5%89%91%E6%8C%87-offer-03.-%E6%95%B0%E7%BB%84%E4%B8%AD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97/">剑指 Offer 03. 数组中重复的数字
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/algorithm/leetcode/%E5%89%91%E6%8C%87-offer-04.-%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE/">剑指 Offer 04. 二维数组中的查找
</a></li><li><a href="https://xuzhijvn.github.io/zh-cn/posts/code/algorithm/leetcode/%E5%89%91%E6%8C%87-offer-05.-%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC/">剑指 Offer 05. 替换空格
</a></li></ul>
  </div>
</section><section class="taxonomies row card component">
      <div class="card-body">
        <h2 class="card-title">
          <a href="https://xuzhijvn.github.io/zh-cn/categories">分类</a>
        </h2>
        <div><a href="https://xuzhijvn.github.io/zh-cn/categories/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/" class="badge bg-primary text-white rounded post-taxonomy" title="编程思想">
            编程思想
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" class="badge bg-primary text-white rounded post-taxonomy" title="云原生">
            云原生
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E5%85%B6%E4%BB%96/" class="badge bg-primary text-white rounded post-taxonomy" title="其他">
            其他
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" class="badge bg-primary text-white rounded post-taxonomy" title="计算机科学">
            计算机科学
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B/" class="badge bg-primary text-white rounded post-taxonomy" title="架构演进">
            架构演进
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E9%83%A8%E7%BD%B2/" class="badge bg-primary text-white rounded post-taxonomy" title="持续集成部署">
            持续集成部署
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" class="badge bg-primary text-white rounded post-taxonomy" title="人工智能">
            人工智能
          </a><a href="https://xuzhijvn.github.io/zh-cn/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" class="badge bg-primary text-white rounded post-taxonomy" title="区块链">
            区块链
          </a></div>
      </div>
    </section><section class="taxonomies row card component">
      <div class="card-body">
        <h2 class="card-title">
          <a href="https://xuzhijvn.github.io/zh-cn/series">专栏</a>
        </h2>
        <div><a href="https://xuzhijvn.github.io/zh-cn/series/manual/" class="badge bg-primary text-white rounded post-taxonomy" title="Manual">
            Manual
          </a><a href="https://xuzhijvn.github.io/zh-cn/series/k8s/" class="badge bg-primary text-white rounded post-taxonomy" title="k8s">
            k8s
          </a><a href="https://xuzhijvn.github.io/zh-cn/series/k8s%E5%AE%9E%E6%88%98/" class="badge bg-primary text-white rounded post-taxonomy" title="k8s实战">
            k8s实战
          </a><a href="https://xuzhijvn.github.io/zh-cn/series/%E7%AE%97%E6%B3%95/" class="badge bg-primary text-white rounded post-taxonomy" title="算法">
            算法
          </a><a href="https://xuzhijvn.github.io/zh-cn/series/istio%E5%AE%9E%E6%88%98/" class="badge bg-primary text-white rounded post-taxonomy" title="istio实战">
            istio实战
          </a></div>
      </div>
    </section><section class="taxonomies row card component">
      <div class="card-body">
        <h2 class="card-title">
          <a href="https://xuzhijvn.github.io/zh-cn/tags">标签</a>
        </h2>
        <div><a href="https://xuzhijvn.github.io/zh-cn/tags/java/" class="badge bg-primary text-white rounded post-taxonomy" title="Java">
            Java
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" class="badge bg-primary text-white rounded post-taxonomy" title="云原生">
            云原生
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/k8s/" class="badge bg-primary text-white rounded post-taxonomy" title="k8s">
            k8s
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/cs/" class="badge bg-primary text-white rounded post-taxonomy" title="CS">
            CS
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/other/" class="badge bg-primary text-white rounded post-taxonomy" title="Other">
            Other
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/spring/" class="badge bg-primary text-white rounded post-taxonomy" title="spring">
            spring
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/mysql/" class="badge bg-primary text-white rounded post-taxonomy" title="MySQL">
            MySQL
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/redis/" class="badge bg-primary text-white rounded post-taxonomy" title="redis">
            redis
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/sa/" class="badge bg-primary text-white rounded post-taxonomy" title="SA">
            SA
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/%E5%89%91%E6%8C%87offer/" class="badge bg-primary text-white rounded post-taxonomy" title="剑指offer">
            剑指offer
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/wordpress/" class="badge bg-primary text-white rounded post-taxonomy" title="WordPress">
            WordPress
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/istio/" class="badge bg-primary text-white rounded post-taxonomy" title="istio">
            istio
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/nginx/" class="badge bg-primary text-white rounded post-taxonomy" title="nginx">
            nginx
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/zk/" class="badge bg-primary text-white rounded post-taxonomy" title="ZK">
            ZK
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/jenkins/" class="badge bg-primary text-white rounded post-taxonomy" title="Jenkins">
            Jenkins
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/ai/" class="badge bg-primary text-white rounded post-taxonomy" title="AI">
            AI
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/cnn/" class="badge bg-primary text-white rounded post-taxonomy" title="CNN">
            CNN
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/http/" class="badge bg-primary text-white rounded post-taxonomy" title="http">
            http
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/system/" class="badge bg-primary text-white rounded post-taxonomy" title="System">
            System
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" class="badge bg-primary text-white rounded post-taxonomy" title="分布式">
            分布式
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/%E7%AE%97%E6%B3%95/" class="badge bg-primary text-white rounded post-taxonomy" title="算法">
            算法
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/blockchain/" class="badge bg-primary text-white rounded post-taxonomy" title="BlockChain">
            BlockChain
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/docker/" class="badge bg-primary text-white rounded post-taxonomy" title="docker">
            docker
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/go/" class="badge bg-primary text-white rounded post-taxonomy" title="GO">
            GO
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/maven/" class="badge bg-primary text-white rounded post-taxonomy" title="Maven">
            Maven
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/mq/" class="badge bg-primary text-white rounded post-taxonomy" title="MQ">
            MQ
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/clickhouse/" class="badge bg-primary text-white rounded post-taxonomy" title="ClickHouse">
            ClickHouse
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/docker-compose/" class="badge bg-primary text-white rounded post-taxonomy" title="docker-compose">
            docker-compose
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/es/" class="badge bg-primary text-white rounded post-taxonomy" title="ES">
            ES
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/github/" class="badge bg-primary text-white rounded post-taxonomy" title="github">
            github
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/io/" class="badge bg-primary text-white rounded post-taxonomy" title="IO">
            IO
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/kafka/" class="badge bg-primary text-white rounded post-taxonomy" title="Kafka">
            Kafka
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/leetcode/" class="badge bg-primary text-white rounded post-taxonomy" title="LeetCode">
            LeetCode
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/mongodb/" class="badge bg-primary text-white rounded post-taxonomy" title="MongoDB">
            MongoDB
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/mybatis/" class="badge bg-primary text-white rounded post-taxonomy" title="MyBatis">
            MyBatis
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/openresty/" class="badge bg-primary text-white rounded post-taxonomy" title="openresty">
            openresty
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/springboot/" class="badge bg-primary text-white rounded post-taxonomy" title="SpringBoot">
            SpringBoot
          </a><a href="https://xuzhijvn.github.io/zh-cn/tags/%E7%89%9B%E5%AE%A2/" class="badge bg-primary text-white rounded post-taxonomy" title="牛客">
            牛客
          </a></div>
      </div>
    </section>
    <section class="ad ad-sticky row surface justify-content-center">
  <ins class="adsbygoogle sidebar-ad"
    data-ad-client="ca-pub-7827859788508375"
    data-ad-slot="5059539159"
    data-ad-format="auto"
    data-full-width-responsive="false"></ins>
</section>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"><a class="nav-link social-link" href="mailto:783175223@qq.com" title="Email">
      <i class="fas fa-fw fa-2x fa-envelope"></i>
    </a><a class="nav-link social-link" target="_blank" href="https://github.com/xuzhijvn" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a><a class="nav-link social-link" target="_blank" href="https://gitlab.com/razonyang" title="GitLab" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-gitlab"></i>
      </a><a class="nav-link social-link" target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=783175223&amp;site=qq&amp;menu=yes" title="QQ" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-qq"></i>
      </a><a class="nav-link social-link" target="_blank" href="https://t.me/razonyang" title="Telegram" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-telegram-plane"></i>
      </a><a class="nav-link social-link" target="_blank" href="https://twitter.com/razonyang" title="Twitter" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-twitter"></i>
      </a></nav>
<div class="copyright mb-2">
  Copyright © 2016-2021 Razon Yang. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank" rel="noopener noreferrer">Bootstrap</a> theme.
</div><div class="mb-3">
  <img src = 'https://xuzhijvn.github.io/icons/gongan.png' class = ' transparent'>
  <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44040302000341">粤公网安备44040302000341号</a>
  |
  <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备20043980号</a>
</div>
</footer>
<script src="https://xuzhijvn.github.io/js/bundle.min.fb05bfc7968380f8d3228b5828f0b4ac2d12c4f0929ae296e4dcd5261b269dc9.js" integrity="sha256-&#43;wW/x5aDgPjTIotYKPC0rC0SxPCSmuKW5NzVJhsmnck=" crossorigin="anonymous" defer></script><script defer src="https://xuzhijvn.github.io/js/viewer.min.9f39f897757e616b3f6faf1d7955ea42a180a4e71d898e80f1c13d45e59b9abb.js" integrity="sha256-nzn4l3V&#43;YWs/b68deVXqQqGApOcdiY6A8cE9ReWbmrs=" crossorigin="anonymous"></script><script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb19b4fde14befc"></script>
<script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?1748e454242a1146387e079e3bb3a92a";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script></body>
</html>
