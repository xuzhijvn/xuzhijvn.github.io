+++
title = "网关设计"
description = ""
date = 2021-09-16T10:29:48+08:00
featured = false
draft = false
comment = true
toc = true
reward = true
categories = [
  "架构演进"
]
tags = [
  "SA"
]
series = ["Manual"]
images = []

+++

`Spring cloud gateway`  👉 `webflux` 👉 `project reactor` 👉 `netty` 👉 `epoll`

<!--more-->

上述流程图指出Spring cloud gateway关键技术依赖。

webflux基于 spring 5.x 和 `reactor-netty` 构建，不依赖于 Servlet 容器，但是可以在支持 Servlet 3.1 Non-Blocking IO API 的容器上运行。

<img src="https://picgo.6and.ltd/img/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dldF9zZXQ=,size_16,color_FFFFFF,t_70.png" alt="webflux" style="zoom: 33%;" />

- Spring WebFlux是基于响应式流的，因此可以用来建立异步的、非阻塞的、事件驱动的服务。它采用Reactor作为首选的响应式流的实现库，不过也提供了对RxJava的支持。
- 由于响应式编程的特性，Spring WebFlux和Reactor底层需要支持异步的运行环境，比如Netty和Undertow；也可以运行在支持异步I/O的Servlet 3.1的容器之上，比如Tomcat（8.0.23及以上）和Jetty（9.0.4及以上）。
- 从图的纵向上看，spring-webflux上层支持两种开发模式：

  1. 类似于Spring WebMVC的基于注解（@Controller、@RequestMapping）的开发模式；

  2. Java 8 lambda 风格的函数式开发模式。
- Spring WebFlux也支持响应式的Websocket服务端开发。

<img src="https://picgo.6and.ltd/img/874963-20200327105251308-818382719.png" alt="webflux2" style="zoom:33%;" />



限流



熔断降级



适配注册中心



认证



动态发布



聚合接口（服务编排）



日志



泛化调用



安全



缓存



业务隔离



Websocket

## 参考

[浅析如何设计一个亿级网关](https://juejin.cn/post/6844903702633906190)

[百亿流量API网关的设计与实现](https://juejin.cn/post/6844904128259293197)

[SpringCloud gateway （史上最全）](https://www.cnblogs.com/crazymakercircle/p/11704077.html)

[（5）Spring WebFlux快速上手——响应式Spring的道法术器](https://blog.csdn.net/get_set/article/details/79480233)

[API网关基石：泛化调用](https://cloud.tencent.com/developer/article/1440665)

[基于 Hystrix 信号量机制实现资源隔离](https://github.com/doocs/advanced-java/blob/main/docs/high-availability/hystrix-semphore-isolation.md)

[Hystrix信号量模式支持超时时间吗](https://toutiao.io/posts/ztgdr2/preview)

