---
title: "ç”Ÿäº§é—®é¢˜å®šä½"
date: 2021-08-27T11:15:10+08:00
draft: false
reward: true
categories: [
"ç¼–ç¨‹æ€æƒ³"
]
tags : [
"Java"
]
series : [
"Manual"
]
images : [
"images/center.png"
]
---

[comment]: <> "# ç”Ÿäº§é—®é¢˜å®šä½"

1. æ’é™¤åº”ç”¨ä¹‹å¤–çš„å½±å“å› ç´ ï¼š `top`(cpu)ã€`free`(å†…å­˜)ã€`df`(ç£ç›˜)ã€`dstat`(ç½‘ç»œæµé‡)ã€`pstack`ã€`vmstat`ã€`st1race`(åº•å±‚ç³»ç»Ÿè°ƒç”¨)

2.  `top` å®šä½CPU æœ€é«˜çš„è¿›ç¨‹

3. `top -Hp pid` å®šä½ä½¿ç”¨ CPU æœ€é«˜çš„çº¿ç¨‹ï¼ˆæˆ–è€… `ps -mp pid -o THREAD,tid,time`ï¼‰

4.  `printf '0x%x' tid` çº¿ç¨‹ id è½¬åŒ– 16 è¿›åˆ¶

5. `jstack pid | grep tid` æ‰¾åˆ°çº¿ç¨‹å †æ ˆ

   5.1 gcçº¿ç¨‹ï¼ˆå¦‚ä¸‹æ˜¯æŸ¥çœ‹gcæƒ…å†µçš„å‡ ç§æ–¹å¼ï¼‰
   
   ğŸ‘‰ğŸ¿ æŸ¥çœ‹gc æ—¥å¿—
   
   ğŸ‘‰ğŸ¿ `jstat -gcutil è¿›ç¨‹å· ç»Ÿè®¡é—´éš”æ¯«ç§’ ç»Ÿè®¡æ¬¡æ•°ï¼ˆç¼ºçœä»£è¡¨ä¸€æ¬¡ç»Ÿè®¡ï¼‰`
   
   ğŸ‘‰ğŸ¿ å¦‚æœæ‰€åœ¨å…¬å¸æœ‰å¯¹åº”ç”¨è¿›è¡Œç›‘æ§çš„ç»„ä»¶å½“ç„¶æ›´æ–¹ä¾¿ï¼ˆæ¯”å¦‚Prometheus + Grafanaï¼‰
   
   > ç»“åˆå†…å­˜`dumpæ—¥å¿—`åˆ†æï¼š
   >
   > 1. å“ªäº›å¯¹è±¡å¯¼è‡´çš„å†…å­˜æº¢å‡ºå¯¼è‡´é¢‘ç¹gcï¼ˆå°¤å…¶æ˜¯full gcï¼‰
   >
   > 2. å¦‚æœä¸æ˜¯å†…å­˜æº¢å‡ºå¯¼è‡´é¢‘ç¹gcï¼Œä¹Ÿå¯èƒ½æ˜¯ä»£ç æˆ–è€…ç¬¬ä¸‰æ–¹ä¾èµ–çš„åŒ…ä¸­æœ‰æ˜¾ç¤ºçš„System.gc()è°ƒç”¨ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡æ·»åŠ  `-XX:+DisableExplicitGC`æ¥ç¦ç”¨JVMå¯¹æ˜¾ç¤ºGCçš„å“åº”ã€‚
   >
   >    åœ¨åˆ†é…å †å¤–å†…å­˜çš„æ—¶å€™ï¼Œå†…å­˜ä¸è¶³æ—¶ä¼šæ˜¾ç¤ºçš„è°ƒç”¨System.gc()ï¼Œå¦‚æœæ˜¾ç¤ºgcè¢«ç¦ç”¨ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å †å¤–å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥å †å¤–å†…å­˜çš„å›æ”¶æœ€å¥½å°±ä¸è¦ä¾èµ–jvmï¼Œä¸»åŠ¨å›æ”¶å§ã€‚
   
   5.2 ä¸šåŠ¡çº¿ç¨‹
   
   ğŸ‘‰ğŸ¿ å…³æ³¨çº¿ç¨‹å †æ ˆçš„`lock`å­—æ®µ
   
   ğŸ‘‰ğŸ¿ `jstack -l pid | grep BLOCKED` æŸ¥çœ‹é˜»å¡æ€çº¿ç¨‹å †æ ˆ

